"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});function pl(){return"specs-core"}const gl=t=>typeof t=="function",u=function(t,e){if(typeof t=="function")return function(){return t(arguments)?e.apply(this,arguments):n=>e(n,...arguments)};switch(t){case 0:case 1:throw new RangeError(`Invalid arity ${t}`);case 2:return function(n,r){return arguments.length>=2?e(n,r):function(s){return e(s,n)}};case 3:return function(n,r,s){return arguments.length>=3?e(n,r,s):function(i){return e(i,n,r)}};case 4:return function(n,r,s,i){return arguments.length>=4?e(n,r,s,i):function(o){return e(o,n,r,s)}};case 5:return function(n,r,s,i,o){return arguments.length>=5?e(n,r,s,i,o):function(c){return e(c,n,r,s,i)}};default:return function(){if(arguments.length>=t)return e.apply(this,arguments);const n=arguments;return function(r){return e(r,...n)}}}},U=t=>t,dr=t=>()=>t,zi=dr(!0),Zr=dr(!1),Qo=dr(void 0),ml=Qo;function f(t,e,n,r,s,i,o,c,a){switch(arguments.length){case 1:return t;case 2:return e(t);case 3:return n(e(t));case 4:return r(n(e(t)));case 5:return s(r(n(e(t))));case 6:return i(s(r(n(e(t)))));case 7:return o(i(s(r(n(e(t))))));case 8:return c(o(i(s(r(n(e(t)))))));case 9:return a(c(o(i(s(r(n(e(t))))))));default:{let l=arguments[0];for(let d=1;d<arguments.length;d++)l=arguments[d](l);return l}}}const Ds=t=>(e,n)=>e===n||t(e,n),_l=u(2,(t,e)=>Ds((n,r)=>t(e(n),e(r)))),yl=t=>Ds((e,n)=>{if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(!t(e[r],n[r]))return!1;return!0}),Qi="effect/GlobalValue";let Be;const M=(t,e)=>(Be||(globalThis[Qi]??=new Map,Be=globalThis[Qi]),Be.has(t)||Be.set(t,e()),Be.get(t)),bl=t=>typeof t=="string",ts=t=>typeof t=="number",Sl=t=>typeof t=="bigint",pr=gl,kl=t=>typeof t=="object"&&t!==null,gr=t=>kl(t)||pr(t),E=u(2,(t,e)=>gr(t)&&e in t),Xo=u(2,(t,e)=>E(t,"_tag")&&t._tag===e),ee=t=>t==null,vl=t=>E(t,"then")&&pr(t.then),mr=t=>`BUG: ${t} - please report an issue at https://github.com/Effect-TS/effect/issues`;let Zo=class tc{self;called=!1;constructor(e){this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new tc(this.self)}};const wl=335903614,Il=4150755663,El=1481765933,Ol=1284865837,$l=9007199254740992,Rl=134217728;class Ml{_state;constructor(e,n,r,s){return ee(n)&&ee(e)?(n=Math.random()*4294967295>>>0,e=0):ee(n)&&(n=e,e=0),ee(s)&&ee(r)?(s=this._state?this._state[3]:Il,r=this._state?this._state[2]:wl):ee(s)&&(s=r,r=0),this._state=new Int32Array([0,0,r>>>0,((s||0)|1)>>>0]),this._next(),Xi(this._state,this._state[0],this._state[1],e>>>0,n>>>0),this._next(),this}getState(){return[this._state[0],this._state[1],this._state[2],this._state[3]]}setState(e){this._state[0]=e[0],this._state[1]=e[1],this._state[2]=e[2],this._state[3]=e[3]|1}integer(e){return Math.round(this.number()*Number.MAX_SAFE_INTEGER)%e}number(){const e=(this._next()&67108863)*1,n=(this._next()&134217727)*1;return(e*Rl+n)/$l}_next(){const e=this._state[0]>>>0,n=this._state[1]>>>0;Tl(this._state,e,n,El,Ol),Xi(this._state,this._state[0],this._state[1],this._state[2],this._state[3]);let r=e>>>18,s=(n>>>18|e<<14)>>>0;r=(r^e)>>>0,s=(s^n)>>>0;const i=(s>>>27|r<<5)>>>0,o=e>>>27,c=(-o>>>0&31)>>>0;return(i>>>o|i<<c)>>>0}}function Tl(t,e,n,r,s){let i=(n>>>16)*(s&65535)>>>0,o=(n&65535)*(s>>>16)>>>0,c=(n&65535)*(s&65535)>>>0,a=(n>>>16)*(s>>>16)+((o>>>16)+(i>>>16))>>>0;o=o<<16>>>0,c=c+o>>>0,c>>>0<o>>>0&&(a=a+1>>>0),i=i<<16>>>0,c=c+i>>>0,c>>>0<i>>>0&&(a=a+1>>>0),a=a+Math.imul(n,r)>>>0,a=a+Math.imul(e,s)>>>0,t[0]=a,t[1]=c}function Xi(t,e,n,r,s){let i=e+r>>>0;const o=n+s>>>0;o>>>0<n>>>0&&(i=i+1|0),t[0]=i,t[1]=o}const es=Symbol.for("effect/Utils/YieldWrap");class ln{#t;constructor(e){this.#t=e}[es](){return this.#t}}function Fl(t){if(typeof t=="object"&&t!==null&&es in t)return t[es]();throw new Error(mr("yieldWrapGet"))}const st=M("effect/Utils/isStructuralRegion",()=>({enabled:!1,tester:void 0})),ec={effect_internal_function:t=>t()},Cl={effect_internal_function:t=>{try{return t()}finally{}}},Nl=ec.effect_internal_function(()=>new Error().stack)?.includes("effect_internal_function")===!0,G=Nl?ec.effect_internal_function:Cl.effect_internal_function,Ur=M(Symbol.for("effect/Hash/randomHashCache"),()=>new WeakMap),w=Symbol.for("effect/Hash"),_=t=>{if(st.enabled===!0)return 0;switch(typeof t){case"number":return Us(t);case"bigint":return x(t.toString(10));case"boolean":return x(String(t));case"symbol":return x(String(t));case"string":return x(t);case"undefined":return x("undefined");case"function":case"object":return t===null?x("null"):t instanceof Date?_(t.toISOString()):t instanceof URL?_(t.href):Al(t)?t[w]():qs(t);default:throw new Error(`BUG: unhandled typeof ${typeof t} - please report an issue at https://github.com/Effect-TS/effect/issues`)}},qs=t=>(Ur.has(t)||Ur.set(t,Us(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),Ur.get(t)),O=t=>e=>e*53^t,_r=t=>t&3221225471|t>>>1&1073741824,Al=t=>E(t,w),Us=t=>{if(t!==t||t===1/0)return 0;let e=t|0;for(e!==t&&(e^=t*4294967295);t>4294967295;)e^=t/=4294967295;return _r(e)},x=t=>{let e=5381,n=t.length;for(;n;)e=e*33^t.charCodeAt(--n);return _r(e)},Pl=(t,e)=>{let n=12289;for(let r=0;r<e.length;r++)n^=f(x(e[r]),O(_(t[e[r]])));return _r(n)},nc=t=>Pl(t,Object.keys(t)),fn=t=>{let e=6151;for(let n=0;n<t.length;n++)e=f(e,O(_(t[n])));return _r(e)},N=function(){if(arguments.length===1){const n=arguments[0];return function(r){return Object.defineProperty(n,w,{value(){return r},enumerable:!1}),r}}const t=arguments[0],e=arguments[1];return Object.defineProperty(t,w,{value(){return e},enumerable:!1}),e},k=Symbol.for("effect/Equal");function v(){return arguments.length===1?t=>Jn(t,arguments[0]):Jn(arguments[0],arguments[1])}function Jn(t,e){if(t===e)return!0;const n=typeof t;if(n!==typeof e)return!1;if(n==="object"||n==="function"){if(t!==null&&e!==null){if(Hn(t)&&Hn(e))return _(t)===_(e)&&t[k](e)?!0:st.enabled&&st.tester?st.tester(t,e):!1;if(t instanceof Date&&e instanceof Date)return t.toISOString()===e.toISOString();if(t instanceof URL&&e instanceof URL)return t.href===e.href}if(st.enabled){if(Array.isArray(t)&&Array.isArray(e))return t.length===e.length&&t.every((r,s)=>Jn(r,e[s]));if(Object.getPrototypeOf(t)===Object.prototype&&Object.getPrototypeOf(t)===Object.prototype){const r=Object.keys(t),s=Object.keys(e);if(r.length===s.length){for(const i of r)if(!(i in e&&Jn(t[i],e[i])))return st.tester?st.tester(t,e):!1;return!0}}return st.tester?st.tester(t,e):!1}}return st.enabled&&st.tester?st.tester(t,e):!1}const Hn=t=>E(t,k),Bs=()=>v,A=Symbol.for("nodejs.util.inspect.custom"),q=t=>{try{if(E(t,"toJSON")&&pr(t.toJSON)&&t.toJSON.length===0)return t.toJSON();if(Array.isArray(t))return t.map(q)}catch{return{}}return Ll(t)},V=t=>JSON.stringify(t,null,2),ae=(t,e=2)=>{if(typeof t=="string")return t;try{return typeof t=="object"?rc(t,e):String(t)}catch{return String(t)}},rc=(t,e)=>{let n=[];const r=JSON.stringify(t,(s,i)=>typeof i=="object"&&i!==null?n.includes(i)?void 0:n.push(i)&&(Jt.fiberRefs!==void 0&&sc(i)?i[Vs](Jt.fiberRefs):i):i,e);return n=void 0,r},Vs=Symbol.for("effect/Inspectable/Redactable"),sc=t=>typeof t=="object"&&t!==null&&Vs in t,Jt=M("effect/Inspectable/redactableState",()=>({fiberRefs:void 0})),xl=(t,e)=>{const n=Jt.fiberRefs;Jt.fiberRefs=t;try{return e()}finally{Jt.fiberRefs=n}},Ll=t=>sc(t)&&Jt.fiberRefs!==void 0?t[Vs](Jt.fiberRefs):t,y=(t,e)=>{switch(e.length){case 0:return t;case 1:return e[0](t);case 2:return e[1](e[0](t));case 3:return e[2](e[1](e[0](t)));case 4:return e[3](e[2](e[1](e[0](t))));case 5:return e[4](e[3](e[2](e[1](e[0](t)))));case 6:return e[5](e[4](e[3](e[2](e[1](e[0](t))))));case 7:return e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))));case 8:return e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t))))))));case 9:return e[8](e[7](e[6](e[5](e[4](e[3](e[2](e[1](e[0](t)))))))));default:{let n=t;for(let r=0,s=e.length;r<s;r++)n=e[r](n);return n}}},Ye="Async",yr="Commit",at="Failure",Br="OnFailure",Gn="OnSuccess",Wn="OnSuccessAndFailure",ut="Success",ic="Sync",jl="Tag",hn="UpdateRuntimeFlags",Yn="While",xn="Iterator",oc="WithRuntime",Ln="Yield",Ks="RevertFlags";let Dl="3.18.4";const Js=()=>Dl,ql=Symbol.for("effect/Effect"),Ul=Symbol.for("effect/Stream"),Bl=Symbol.for("effect/Sink"),Vl=Symbol.for("effect/Channel"),ue={_R:t=>t,_E:t=>t,_A:t=>t,_V:Js()},Kl={_A:t=>t,_In:t=>t,_L:t=>t,_E:t=>t,_R:t=>t},Jl={_Env:t=>t,_InErr:t=>t,_InElem:t=>t,_InDone:t=>t,_OutErr:t=>t,_OutElem:t=>t,_OutDone:t=>t},dn={[ql]:ue,[Ul]:ue,[Bl]:Kl,[Vl]:Jl,[k](t){return this===t},[w](){return N(this,qs(this))},[Symbol.iterator](){return new Zo(new ln(this))},pipe(){return y(this,arguments)}},Hs={[w](){return N(this,nc(this))},[k](t){const e=Object.keys(this),n=Object.keys(t);if(e.length!==n.length)return!1;for(const r of e)if(!(r in t&&v(this[r],t[r])))return!1;return!0}},pn={...dn,_op:yr},Hl={...pn,...Hs},Gl=(function(){function t(){}return t.prototype=pn,t})(),cc=Symbol.for("effect/Option"),ac={...dn,[cc]:{_A:t=>t},[A](){return this.toJSON()},toString(){return V(this.toJSON())}},Wl=Object.assign(Object.create(ac),{_tag:"Some",_op:"Some",[k](t){return uc(t)&&fc(t)&&v(this.value,t.value)},[w](){return N(this,O(_(this._tag))(_(this.value)))},toJSON(){return{_id:"Option",_tag:this._tag,value:q(this.value)}}}),Yl=_("None"),zl=Object.assign(Object.create(ac),{_tag:"None",_op:"None",[k](t){return uc(t)&&lc(t)},[w](){return Yl},toJSON(){return{_id:"Option",_tag:this._tag}}}),uc=t=>E(t,cc),lc=t=>t._tag==="None",fc=t=>t._tag==="Some",hc=Object.create(zl),ns=t=>{const e=Object.create(Wl);return e.value=t,e},dc=Symbol.for("effect/Either"),pc={...dn,[dc]:{_R:t=>t},[A](){return this.toJSON()},toString(){return V(this.toJSON())}},Ql=Object.assign(Object.create(pc),{_tag:"Right",_op:"Right",[k](t){return gc(t)&&_c(t)&&v(this.right,t.right)},[w](){return O(_(this._tag))(_(this.right))},toJSON(){return{_id:"Either",_tag:this._tag,right:q(this.right)}}}),Xl=Object.assign(Object.create(pc),{_tag:"Left",_op:"Left",[k](t){return gc(t)&&mc(t)&&v(this.left,t.left)},[w](){return O(_(this._tag))(_(this.left))},toJSON(){return{_id:"Either",_tag:this._tag,left:q(this.left)}}}),gc=t=>E(t,dc),mc=t=>t._tag==="Left",_c=t=>t._tag==="Right",Zl=t=>{const e=Object.create(Xl);return e.left=t,e},tf=t=>{const e=Object.create(Ql);return e.right=t,e},Mt=tf,le=Zl,We=mc,Mn=_c,ef=u(2,(t,{onLeft:e,onRight:n})=>We(t)?e(t.left):n(t.right)),nf=ef({onLeft:U,onRight:U}),yc=t=>t.length>0,bc=t=>(e,n)=>e===n?0:t(e,n),rf=bc((t,e)=>t<e?-1:1),sf=u(2,(t,e)=>bc((n,r)=>t(e(n),e(r)))),of=t=>u(2,(e,n)=>t(e,n)===1),S=()=>hc,R=ns,Q=lc,kt=fc,Gs=u(2,(t,{onNone:e,onSome:n})=>Q(t)?e():n(t.value)),Wt=u(2,(t,e)=>Q(t)?e():t.value),cf=u(2,(t,e)=>Q(t)?R(e()):t),Ws=t=>t==null?S():R(t),Dt=Wt(Qo),af=u(2,(t,e)=>Q(t)?S():R(e(t.value))),uf=u(2,(t,e)=>Q(t)?S():e(t.value)),lf=t=>u(2,(e,n)=>Q(e)?!1:t(e.value,n)),ff=Bs(),hf=lf(ff),df=(...t)=>t,Ys=t=>new Array(t),pf=u(2,(t,e)=>{const n=Math.max(1,Math.floor(t)),r=new Array(n);for(let s=0;s<n;s++)r[s]=e(s);return r}),B=t=>Array.isArray(t)?t:Array.from(t),gf=t=>Array.isArray(t)?t:[t],zn=u(2,(t,e)=>[e,...t]),mf=u(2,(t,e)=>[...t,e]),Sc=u(2,(t,e)=>B(t).concat(B(e))),_f=t=>t.length===0,yf=_f,bf=yc,tt=yc,kc=(t,e)=>t<0||t>=e.length,Sf=(t,e)=>Math.floor(Math.min(Math.max(0,t),e.length)),kf=u(2,(t,e)=>{const n=Math.floor(e);return kc(n,t)?S():R(t[n])}),vc=u(2,(t,e)=>{const n=Math.floor(e);if(kc(n,t))throw new Error(`Index ${n} out of bounds`);return t[n]}),ze=kf(0),X=vc(0),vf=t=>tt(t)?R(wc(t)):S(),wc=t=>t[t.length-1],fe=t=>t.slice(1),wf=(t,e)=>{let n=0;for(const r of t){if(!e(r,n))break;n++}return n},If=u(2,(t,e)=>Rf(t,wf(t,e))),Ef=u(2,(t,e)=>{const n=B(t);return n.slice(Sf(e,n),n.length)}),Zi=t=>Array.from(t).reverse(),Qn=u(2,(t,e)=>{const n=Array.from(t);return n.sort(e),n}),to=u(2,(t,e)=>Of(t,e,df)),Of=u(3,(t,e,n)=>{const r=B(t),s=B(e);if(tt(r)&&tt(s)){const i=[n(X(r),X(s))],o=Math.min(r.length,s.length);for(let c=1;c<o;c++)i[c]=n(r[c],s[c]);return i}return[]}),$f=Bs(),Rf=u(2,(t,e)=>{const n=Array.from(t),r=Math.floor(e);return tt(n)?r>=1?Mf(n,r):[[],n]:[n,[]]}),Mf=u(2,(t,e)=>{const n=Math.max(1,Math.floor(e));return n>=t.length?[Tf(t),[]]:[zn(t.slice(1,n),X(t)),t.slice(n)]}),Tf=t=>t.slice(),Ff=u(3,(t,e,n)=>{const r=B(t),s=B(e);return tt(r)?tt(s)?Ec(n)(Sc(r,s)):r:s}),jn=u(2,(t,e)=>Ff(t,e,$f)),he=()=>[],ft=t=>[t],se=u(2,(t,e)=>t.map(e)),Cf=u(2,(t,e)=>{if(yf(t))return[];const n=[];for(let r=0;r<t.length;r++){const s=e(t[r],r);for(let i=0;i<s.length;i++)n.push(s[i])}return n}),Nf=Cf(U),Ic=u(3,(t,e,n)=>B(t).reduce((r,s,i)=>n(r,s,i),e)),eo=(t,e)=>{const n=[];let r=t,s;for(;kt(s=e(r));){const[i,o]=s.value;n.push(i),r=o}return n},zs=yl,Ec=u(2,(t,e)=>{const n=B(t);if(tt(n)){const r=[X(n)],s=fe(n);for(const i of s)r.every(o=>!e(i,o))&&r.push(i);return r}return[]}),Af=t=>Ec(t,Bs()),Me=u(2,(t,e)=>B(t).join(e)),Ze=rf,Pf=t=>t.replace(/[/\\^$*+?.()|[\]{}]/g,"\\$&"),xf=Symbol.for("effect/Context/Tag"),Xn=Symbol.for("effect/Context/Reference"),Lf="effect/STM",jf=Symbol.for(Lf),Oc={...dn,_op:"Tag",[jf]:ue,[xf]:{_Service:t=>t,_Identifier:t=>t},toString(){return V(this.toJSON())},toJSON(){return{_id:"Tag",key:this.key,stack:this.stack}},[A](){return this.toJSON()},of(t){return t},context(t){return Wf(this,t)}},Df={...Oc,[Xn]:Xn},qf=t=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=2;const n=new Error;Error.stackTraceLimit=e;const r=Object.create(Oc);return Object.defineProperty(r,"stack",{get(){return n.stack}}),r.key=t,r},Uf=()=>(t,e)=>{const n=Error.stackTraceLimit;Error.stackTraceLimit=2;const r=new Error;Error.stackTraceLimit=n;function s(){}return Object.setPrototypeOf(s,Df),s.key=t,s.defaultValue=e.defaultValue,Object.defineProperty(s,"stack",{get(){return r.stack}}),s},$c=Symbol.for("effect/Context"),Bf={[$c]:{_Services:t=>t},[k](t){if(Kf(t)&&this.unsafeMap.size===t.unsafeMap.size){for(const e of this.unsafeMap.keys())if(!t.unsafeMap.has(e)||!v(this.unsafeMap.get(e),t.unsafeMap.get(e)))return!1;return!0}return!1},[w](){return N(this,Us(this.unsafeMap.size))},pipe(){return y(this,arguments)},toString(){return V(this.toJSON())},toJSON(){return{_id:"Context",services:Array.from(this.unsafeMap).map(q)}},[A](){return this.toJSON()}},de=t=>{const e=Object.create(Bf);return e.unsafeMap=t,e},Vf=t=>{const e=new Error(`Service not found${t.key?`: ${String(t.key)}`:""}`);if(t.stack){const n=t.stack.split(`
`);if(n.length>2){const r=n[2].match(/at (.*)/);r&&(e.message=e.message+` (defined at ${r[1]})`)}}if(e.stack){const n=e.stack.split(`
`);n.splice(1,3),e.stack=n.join(`
`)}return e},Kf=t=>E(t,$c),Jf=t=>E(t,Xn),Hf=de(new Map),Gf=()=>Hf,Wf=(t,e)=>de(new Map([[t.key,e]])),Yf=u(3,(t,e,n)=>{const r=new Map(t.unsafeMap);return r.set(e.key,n),de(r)}),Vr=M("effect/Context/defaultValueCache",()=>new Map),Qs=t=>{if(Vr.has(t.key))return Vr.get(t.key);const e=t.defaultValue();return Vr.set(t.key,e),e},zf=(t,e)=>t.unsafeMap.has(e.key)?t.unsafeMap.get(e.key):Qs(e),Rc=u(2,(t,e)=>{if(!t.unsafeMap.has(e.key)){if(Xn in e)return Qs(e);throw Vf(e)}return t.unsafeMap.get(e.key)}),Qf=Rc,Xf=u(2,(t,e)=>t.unsafeMap.has(e.key)?ns(t.unsafeMap.get(e.key)):Jf(e)?ns(Qs(e)):hc),Zf=u(2,(t,e)=>{const n=new Map(t.unsafeMap);for(const[r,s]of e.unsafeMap)n.set(r,s);return de(n)}),Te=qf,Xs=Gf,Ve=Yf,Zs=Qf,Mc=Rc,th=Xf,eh=Zf,Tc=Uf,Fc=Symbol.for("effect/Chunk");function nh(t,e,n,r,s){for(let i=e;i<Math.min(t.length,e+s);i++)n[r+i-e]=t[i];return n}const Cc=[],rh=t=>Ds((e,n)=>e.length===n.length&&Ht(e).every((r,s)=>t(r,ie(n,s)))),sh=rh(v),ih={[Fc]:{_A:t=>t},toString(){return V(this.toJSON())},toJSON(){return{_id:"Chunk",values:Ht(this).map(q)}},[A](){return this.toJSON()},[k](t){return Nc(t)&&sh(this,t)},[w](){return N(this,fn(Ht(this)))},[Symbol.iterator](){switch(this.backing._tag){case"IArray":return this.backing.array[Symbol.iterator]();case"IEmpty":return Cc[Symbol.iterator]();default:return Ht(this)[Symbol.iterator]()}},pipe(){return y(this,arguments)}},L=t=>{const e=Object.create(ih);switch(e.backing=t,t._tag){case"IEmpty":{e.length=0,e.depth=0,e.left=e,e.right=e;break}case"IConcat":{e.length=t.left.length+t.right.length,e.depth=1+Math.max(t.left.depth,t.right.depth),e.left=t.left,e.right=t.right;break}case"IArray":{e.length=t.array.length,e.depth=0,e.left=bt,e.right=bt;break}case"ISingleton":{e.length=1,e.depth=0,e.left=bt,e.right=bt;break}case"ISlice":{e.length=t.length,e.depth=t.chunk.depth+1,e.left=bt,e.right=bt;break}}return e},Nc=t=>E(t,Fc),bt=L({_tag:"IEmpty"}),Ft=()=>bt,Kr=(...t)=>ah(t),et=t=>L({_tag:"ISingleton",a:t}),Ac=t=>Nc(t)?t:br(B(t)),rs=(t,e,n)=>{switch(t.backing._tag){case"IArray":{nh(t.backing.array,0,e,n,t.length);break}case"IConcat":{rs(t.left,e,n),rs(t.right,e,n+t.left.length);break}case"ISingleton":{e[n]=t.backing.a;break}case"ISlice":{let r=0,s=n;for(;r<t.length;)e[s]=ie(t,r),r+=1,s+=1;break}}},oh=t=>{switch(t.backing._tag){case"IEmpty":return Cc;case"IArray":return t.backing.array;default:{const e=new Array(t.length);return rs(t,e,0),t.backing={_tag:"IArray",array:e},t.left=bt,t.right=bt,t.depth=0,e}}},Ht=oh,ch=t=>{switch(t.backing._tag){case"IEmpty":case"ISingleton":return t;case"IArray":return L({_tag:"IArray",array:Zi(t.backing.array)});case"IConcat":return L({_tag:"IConcat",left:pe(t.backing.right),right:pe(t.backing.left)});case"ISlice":return br(Zi(Ht(t)))}},pe=ch,br=t=>t.length===0?Ft():t.length===1?et(t[0]):L({_tag:"IArray",array:t}),ah=t=>br(t),ie=u(2,(t,e)=>{switch(t.backing._tag){case"IEmpty":throw new Error("Index out of bounds");case"ISingleton":{if(e!==0)throw new Error("Index out of bounds");return t.backing.a}case"IArray":{if(e>=t.length||e<0)throw new Error("Index out of bounds");return t.backing.array[e]}case"IConcat":return e<t.left.length?ie(t.left,e):ie(t.right,e-t.left.length);case"ISlice":return ie(t.backing.chunk,e+t.backing.offset)}}),uh=u(2,(t,e)=>ht(t,et(e))),pt=u(2,(t,e)=>ht(et(e),t)),ss=u(2,(t,e)=>{if(e<=0)return t;if(e>=t.length)return bt;switch(t.backing._tag){case"ISlice":return L({_tag:"ISlice",chunk:t.backing.chunk,offset:t.backing.offset+e,length:t.backing.length-e});case"IConcat":return e>t.left.length?ss(t.right,e-t.left.length):L({_tag:"IConcat",left:ss(t.left,e),right:t.right});default:return L({_tag:"ISlice",chunk:t,offset:e,length:t.length-e})}}),ht=u(2,(t,e)=>{if(t.backing._tag==="IEmpty")return e;if(e.backing._tag==="IEmpty")return t;const n=e.depth-t.depth;if(Math.abs(n)<=1)return L({_tag:"IConcat",left:t,right:e});if(n<-1)if(t.left.depth>=t.right.depth){const r=ht(t.right,e);return L({_tag:"IConcat",left:t.left,right:r})}else{const r=ht(t.right.right,e);if(r.depth===t.depth-3){const s=L({_tag:"IConcat",left:t.right.left,right:r});return L({_tag:"IConcat",left:t.left,right:s})}else{const s=L({_tag:"IConcat",left:t.left,right:t.right.left});return L({_tag:"IConcat",left:s,right:r})}}else if(e.right.depth>=e.left.depth){const r=ht(t,e.left);return L({_tag:"IConcat",left:r,right:e.right})}else{const r=ht(t,e.left.left);if(r.depth===e.depth-3){const s=L({_tag:"IConcat",left:r,right:e.left.right});return L({_tag:"IConcat",left:s,right:e.right})}else{const s=L({_tag:"IConcat",left:e.left.right,right:e.right});return L({_tag:"IConcat",left:r,right:s})}}}),lh=t=>t.length===0,ge=t=>t.length>0,Pc=t=>ie(t,0),me=Pc,Ut=t=>ss(t,1),is=Symbol.for("effect/Duration"),xc=BigInt(0),no=BigInt(24),Tn=BigInt(60),os=BigInt(1e3),ro=BigInt(1e6),so=BigInt(1e9),fh=/^(-?\d+(?:\.\d+)?)\s+(nanos?|micros?|millis?|seconds?|minutes?|hours?|days?|weeks?)$/,Ct=t=>{if(Lc(t))return t;if(ts(t))return cs(t);if(Sl(t))return Jr(t);if(Array.isArray(t)&&t.length===2&&t.every(ts))return t[0]===-1/0||t[1]===-1/0||Number.isNaN(t[0])||Number.isNaN(t[1])?jc:t[0]===1/0||t[1]===1/0?gh:Jr(BigInt(Math.round(t[0]*1e9))+BigInt(Math.round(t[1])));if(bl(t)){const e=fh.exec(t);if(e){const[n,r,s]=e,i=Number(r);switch(s){case"nano":case"nanos":return Jr(BigInt(r));case"micro":case"micros":return mh(BigInt(r));case"milli":case"millis":return cs(i);case"second":case"seconds":return _h(i);case"minute":case"minutes":return yh(i);case"hour":case"hours":return bh(i);case"day":case"days":return Sh(i);case"week":case"weeks":return kh(i)}}}throw new Error("Invalid DurationInput")},io={_tag:"Millis",millis:0},hh={_tag:"Infinity"},dh={[is]:is,[w](){return N(this,nc(this.value))},[k](t){return Lc(t)&&Rh(this,t)},toString(){return`Duration(${Th(this)})`},toJSON(){switch(this.value._tag){case"Millis":return{_id:"Duration",_tag:"Millis",millis:this.value.millis};case"Nanos":return{_id:"Duration",_tag:"Nanos",hrtime:wh(this)};case"Infinity":return{_id:"Duration",_tag:"Infinity"}}},[A](){return this.toJSON()},pipe(){return y(this,arguments)}},wt=t=>{const e=Object.create(dh);return ts(t)?isNaN(t)||t<=0?e.value=io:Number.isFinite(t)?Number.isInteger(t)?e.value={_tag:"Millis",millis:t}:e.value={_tag:"Nanos",nanos:BigInt(Math.round(t*1e6))}:e.value=hh:t<=xc?e.value=io:e.value={_tag:"Nanos",nanos:t},e},Lc=t=>E(t,is),ph=t=>{switch(t.value._tag){case"Millis":return t.value.millis===0;case"Nanos":return t.value.nanos===xc;case"Infinity":return!1}},jc=wt(0),gh=wt(1/0),Jr=t=>wt(t),mh=t=>wt(t*os),cs=t=>wt(t),_h=t=>wt(t*1e3),yh=t=>wt(t*6e4),bh=t=>wt(t*36e5),Sh=t=>wt(t*864e5),kh=t=>wt(t*6048e5),as=t=>Ih(t,{onMillis:e=>e,onNanos:e=>Number(e)/1e6}),vh=t=>{const e=Ct(t);switch(e.value._tag){case"Infinity":throw new Error("Cannot convert infinite duration to nanos");case"Nanos":return e.value.nanos;case"Millis":return BigInt(Math.round(e.value.millis*1e6))}},wh=t=>{const e=Ct(t);switch(e.value._tag){case"Infinity":return[1/0,0];case"Nanos":return[Number(e.value.nanos/so),Number(e.value.nanos%so)];case"Millis":return[Math.floor(e.value.millis/1e3),Math.round(e.value.millis%1e3*1e6)]}},Ih=u(2,(t,e)=>{const n=Ct(t);switch(n.value._tag){case"Nanos":return e.onNanos(n.value.nanos);case"Infinity":return e.onMillis(1/0);case"Millis":return e.onMillis(n.value.millis)}}),ti=u(3,(t,e,n)=>{const r=Ct(t),s=Ct(e);if(r.value._tag==="Infinity"||s.value._tag==="Infinity")return n.onMillis(as(r),as(s));if(r.value._tag==="Nanos"||s.value._tag==="Nanos"){const i=r.value._tag==="Nanos"?r.value.nanos:BigInt(Math.round(r.value.millis*1e6)),o=s.value._tag==="Nanos"?s.value.nanos:BigInt(Math.round(s.value.millis*1e6));return n.onNanos(i,o)}return n.onMillis(r.value.millis,s.value.millis)}),Eh=(t,e)=>ti(t,e,{onMillis:(n,r)=>n===r,onNanos:(n,r)=>n===r}),Oh=u(2,(t,e)=>ti(t,e,{onMillis:(n,r)=>n<=r,onNanos:(n,r)=>n<=r})),$h=u(2,(t,e)=>ti(t,e,{onMillis:(n,r)=>n>=r,onNanos:(n,r)=>n>=r})),Rh=u(2,(t,e)=>Eh(Ct(t),Ct(e))),Mh=t=>{const e=Ct(t);if(e.value._tag==="Infinity")return{days:1/0,hours:1/0,minutes:1/0,seconds:1/0,millis:1/0,nanos:1/0};const n=vh(e),r=n/ro,s=r/os,i=s/Tn,o=i/Tn,c=o/no;return{days:Number(c),hours:Number(o%no),minutes:Number(i%Tn),seconds:Number(s%Tn),millis:Number(r%os),nanos:Number(n%ro)}},Th=t=>{const e=Ct(t);if(e.value._tag==="Infinity")return"Infinity";if(ph(e))return"0";const n=Mh(e),r=[];return n.days!==0&&r.push(`${n.days}d`),n.hours!==0&&r.push(`${n.hours}h`),n.minutes!==0&&r.push(`${n.minutes}m`),n.seconds!==0&&r.push(`${n.seconds}s`),n.millis!==0&&r.push(`${n.millis}ms`),n.nanos!==0&&r.push(`${n.nanos}ns`),r.join(" ")},Yt=5,ei=Math.pow(2,Yt),Fh=ei-1,Ch=ei/2,Nh=ei/4;function Ah(t){return t-=t>>1&1431655765,t=(t&858993459)+(t>>2&858993459),t=t+(t>>4)&252645135,t+=t>>8,t+=t>>16,t&127}function _e(t,e){return e>>>t&Fh}function re(t){return 1<<t}function Dc(t,e){return Ah(t&e-1)}const Ph=(t,e)=>({value:t,previous:e});function oe(t,e,n,r){let s=r;if(!t){const i=r.length;s=new Array(i);for(let o=0;o<i;++o)s[o]=r[o]}return s[e]=n,s}function qc(t,e,n){const r=n.length-1;let s=0,i=0,o=n;if(t)s=i=e;else for(o=new Array(r);s<e;)o[i++]=n[s++];for(++s;s<=r;)o[i++]=n[s++];return t&&(o.length=r),o}function xh(t,e,n,r){const s=r.length;if(t){let a=s;for(;a>=e;)r[a--]=r[a];return r[e]=n,r}let i=0,o=0;const c=new Array(s+1);for(;i<e;)c[o++]=r[i++];for(c[e]=n;i<s;)c[++o]=r[i++];return c}class Pt{_tag="EmptyNode";modify(e,n,r,s,i,o){const c=r(S());return Q(c)?new Pt:(++o.value,new Gt(e,s,i,c))}}function dt(t){return Xo(t,"EmptyNode")}function Lh(t){return dt(t)||t._tag==="LeafNode"||t._tag==="CollisionNode"}function Sr(t,e){return dt(t)?!1:e===t.edit}class Gt{edit;hash;key;value;_tag="LeafNode";constructor(e,n,r,s){this.edit=e,this.hash=n,this.key=r,this.value=s}modify(e,n,r,s,i,o){if(v(i,this.key)){const a=r(this.value);return a===this.value?this:Q(a)?(--o.value,new Pt):Sr(this,e)?(this.value=a,this):new Gt(e,s,i,a)}const c=r(S());return Q(c)?this:(++o.value,Uc(e,n,this.hash,this,s,new Gt(e,s,i,c)))}}class ni{edit;hash;children;_tag="CollisionNode";constructor(e,n,r){this.edit=e,this.hash=n,this.children=r}modify(e,n,r,s,i,o){if(s===this.hash){const a=Sr(this,e),l=this.updateCollisionList(a,e,this.hash,this.children,r,i,o);return l===this.children?this:l.length>1?new ni(e,this.hash,l):l[0]}const c=r(S());return Q(c)?this:(++o.value,Uc(e,n,this.hash,this,s,new Gt(e,s,i,c)))}updateCollisionList(e,n,r,s,i,o,c){const a=s.length;for(let d=0;d<a;++d){const h=s[d];if("key"in h&&v(o,h.key)){const p=h.value,g=i(p);return g===p?s:Q(g)?(--c.value,qc(e,d,s)):oe(e,d,new Gt(n,r,o,g),s)}}const l=i(S());return Q(l)?s:(++c.value,oe(e,a,new Gt(n,r,o,l),s))}}class ye{edit;mask;children;_tag="IndexedNode";constructor(e,n,r){this.edit=e,this.mask=n,this.children=r}modify(e,n,r,s,i,o){const c=this.mask,a=this.children,l=_e(n,s),d=re(l),h=Dc(c,d),p=c&d,g=Sr(this,e);if(!p){const J=new Pt().modify(e,n+Yt,r,s,i,o);return J?a.length>=Ch?Dh(e,l,J,c,a):new ye(e,c|d,xh(g,h,J,a)):this}const m=a[h],$=m.modify(e,n+Yt,r,s,i,o);if(m===$)return this;let F=c,K;if(dt($)){if(F&=~d,!F)return new Pt;if(a.length<=2&&Lh(a[h^1]))return a[h^1];K=qc(g,h,a)}else K=oe(g,h,$,a);return g?(this.mask=F,this.children=K,this):new ye(e,F,K)}}class ri{edit;size;children;_tag="ArrayNode";constructor(e,n,r){this.edit=e,this.size=n,this.children=r}modify(e,n,r,s,i,o){let c=this.size;const a=this.children,l=_e(n,s),d=a[l],h=(d||new Pt).modify(e,n+Yt,r,s,i,o);if(d===h)return this;const p=Sr(this,e);let g;if(dt(d)&&!dt(h))++c,g=oe(p,l,h,a);else if(!dt(d)&&dt(h)){if(--c,c<=Nh)return jh(e,c,l,a);g=oe(p,l,new Pt,a)}else g=oe(p,l,h,a);return p?(this.size=c,this.children=g,this):new ri(e,c,g)}}function jh(t,e,n,r){const s=new Array(e-1);let i=0,o=0;for(let c=0,a=r.length;c<a;++c)if(c!==n){const l=r[c];l&&!dt(l)&&(s[i++]=l,o|=1<<c)}return new ye(t,o,s)}function Dh(t,e,n,r,s){const i=[];let o=r,c=0;for(let a=0;o;++a)o&1&&(i[a]=s[c++]),o>>>=1;return i[e]=n,new ri(t,c+1,i)}function qh(t,e,n,r,s,i){if(n===s)return new ni(t,n,[i,r]);const o=_e(e,n),c=_e(e,s);if(o===c)return a=>new ye(t,re(o)|re(c),[a]);{const a=o<c?[r,i]:[i,r];return new ye(t,re(o)|re(c),a)}}function Uc(t,e,n,r,s,i){let o,c=e;for(;;){const a=qh(t,c,n,r,s,i);if(typeof a=="function")o=Ph(a,o),c=c+Yt;else{let l=a;for(;o!=null;)l=o.value(l),o=o.previous;return l}}}const Bc="effect/HashMap",us=Symbol.for(Bc),Uh={[us]:us,[Symbol.iterator](){return new kr(this,(t,e)=>[t,e])},[w](){let t=_(Bc);for(const e of this)t^=f(_(e[0]),O(_(e[1])));return N(this,t)},[k](t){if(Kh(t)){if(t._size!==this._size)return!1;for(const e of this){const n=f(t,ii(e[0],_(e[0])));if(Q(n))return!1;if(!v(e[1],n.value))return!1}return!0}return!1},toString(){return V(this.toJSON())},toJSON(){return{_id:"HashMap",values:Array.from(this).map(q)}},[A](){return this.toJSON()},pipe(){return y(this,arguments)}},si=(t,e,n,r)=>{const s=Object.create(Uh);return s._editable=t,s._edit=e,s._root=n,s._size=r,s};class kr{map;f;v;constructor(e,n){this.map=e,this.f=n,this.v=Vc(this.map._root,this.f,void 0)}next(){if(Q(this.v))return{done:!0,value:void 0};const e=this.v.value;return this.v=Zn(e.cont),{done:!1,value:e.value}}[Symbol.iterator](){return new kr(this.map,this.f)}}const Zn=t=>t?Kc(t[0],t[1],t[2],t[3],t[4]):S(),Vc=(t,e,n=void 0)=>{switch(t._tag){case"LeafNode":return kt(t.value)?R({value:e(t.key,t.value.value),cont:n}):Zn(n);case"CollisionNode":case"ArrayNode":case"IndexedNode":{const r=t.children;return Kc(r.length,r,0,e,n)}default:return Zn(n)}},Kc=(t,e,n,r,s)=>{for(;n<t;){const i=e[n++];if(i&&!dt(i))return Vc(i,r,[t,e,n,r,s])}return Zn(s)},Bh=si(!1,0,new Pt,0),vr=()=>Bh,Vh=t=>{const e=Hc(vr());for(const n of t)tn(e,n[0],n[1]);return Yh(e)},Kh=t=>E(t,us),Jh=t=>t&&dt(t._root),Hh=u(2,(t,e)=>ii(t,e,_(e))),ii=u(3,(t,e,n)=>{let r=t._root,s=0;for(;;)switch(r._tag){case"LeafNode":return v(e,r.key)?r.value:S();case"CollisionNode":{if(n===r.hash){const i=r.children;for(let o=0,c=i.length;o<c;++o){const a=i[o];if("key"in a&&v(e,a.key))return a.value}}return S()}case"IndexedNode":{const i=_e(s,n),o=re(i);if(r.mask&o){r=r.children[Dc(r.mask,o)],s+=Yt;break}return S()}case"ArrayNode":{if(r=r.children[_e(s,n)],r){s+=Yt;break}return S()}default:return S()}}),Gh=u(2,(t,e)=>kt(ii(t,e,_(e)))),tn=u(3,(t,e,n)=>oi(t,e,()=>R(n))),Wh=u(3,(t,e,n)=>t._editable?(t._root=e,t._size=n,t):e===t._root?t:si(t._editable,t._edit,e,n)),Jc=t=>new kr(t,e=>e),ls=t=>t._size,Hc=t=>si(!0,t._edit+1,t._root,t._size),Yh=t=>(t._editable=!1,t),oi=u(3,(t,e,n)=>zh(t,e,_(e),n)),zh=u(4,(t,e,n,r)=>{const s={value:t._size},i=t._root.modify(t._editable?t._edit:NaN,0,r,n,e,s);return f(t,Wh(i,s.value))}),oo=u(2,(t,e)=>oi(t,e,S)),Qh=u(2,(t,e)=>wr(t,vr(),(n,r,s)=>tn(n,s,e(r,s)))),Xh=u(2,(t,e)=>wr(t,void 0,(n,r,s)=>e(r,s))),wr=u(3,(t,e,n)=>{const r=t._root;if(r._tag==="LeafNode")return kt(r.value)?n(e,r.value.value,r.key):e;if(r._tag==="EmptyNode")return e;const s=[r.children];let i;for(;i=s.pop();)for(let o=0,c=i.length;o<c;){const a=i[o++];a&&!dt(a)&&(a._tag==="LeafNode"?kt(a.value)&&(e=n(e,a.value.value,a.key)):s.push(a.children))}return e}),Gc="effect/HashSet",fs=Symbol.for(Gc),Zh={[fs]:fs,[Symbol.iterator](){return Jc(this._keyMap)},[w](){return N(this,O(_(this._keyMap))(_(Gc)))},[k](t){return td(t)?ls(this._keyMap)===ls(t._keyMap)&&v(this._keyMap,t._keyMap):!1},toString(){return V(this.toJSON())},toJSON(){return{_id:"HashSet",values:Array.from(this).map(q)}},[A](){return this.toJSON()},pipe(){return y(this,arguments)}},Ir=t=>{const e=Object.create(Zh);return e._keyMap=t,e},td=t=>E(t,fs),ed=Ir(vr()),Er=()=>ed,nd=t=>{const e=ci(Er());for(const n of t)en(e,n);return ai(e)},rd=(...t)=>{const e=ci(Er());for(const n of t)en(e,n);return ai(e)},sd=u(2,(t,e)=>Gh(t._keyMap,e)),id=t=>ls(t._keyMap),ci=t=>Ir(Hc(t._keyMap)),ai=t=>(t._keyMap._editable=!1,t),Wc=u(2,(t,e)=>{const n=ci(t);return e(n),ai(n)}),en=u(2,(t,e)=>t._keyMap._editable?(tn(e,!0)(t._keyMap),t):Ir(tn(e,!0)(t._keyMap))),Yc=u(2,(t,e)=>t._keyMap._editable?(oo(e)(t._keyMap),t):Ir(oo(e)(t._keyMap))),od=u(2,(t,e)=>Wc(t,n=>{for(const r of e)Yc(n,r)})),cd=u(2,(t,e)=>Wc(Er(),n=>{ad(t,r=>en(n,r));for(const r of e)en(n,r)})),ad=u(2,(t,e)=>Xh(t._keyMap,(n,r)=>e(r))),ud=u(3,(t,e,n)=>wr(t._keyMap,e,(r,s,i)=>n(r,i))),zt=Er,ld=nd,ui=rd,fd=sd,zc=id,Qe=en,Qc=Yc,co=od,nn=cd,tr=ud,ao=Symbol.for("effect/MutableRef"),hd={[ao]:ao,toString(){return V(this.toJSON())},toJSON(){return{_id:"MutableRef",current:q(this.current)}},[A](){return this.toJSON()},pipe(){return y(this,arguments)}},Xc=t=>{const e=Object.create(hd);return e.current=t,e},Or=t=>t.current,Zc=u(2,(t,e)=>(t.current=e,t)),li="effect/FiberId",rn=Symbol.for(li),er="None",hs="Runtime",dd="Composite",pd=x(`${li}-${er}`);let gd=class{[rn]=rn;_tag=er;id=-1;startTimeMillis=-1;[w](){return pd}[k](e){return ta(e)&&e._tag===er}toString(){return V(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag}}[A](){return this.toJSON()}};class md{id;startTimeMillis;[rn]=rn;_tag=hs;constructor(e,n){this.id=e,this.startTimeMillis=n}[w](){return N(this,x(`${li}-${this._tag}-${this.id}-${this.startTimeMillis}`))}[k](e){return ta(e)&&e._tag===hs&&this.id===e.id&&this.startTimeMillis===e.startTimeMillis}toString(){return V(this.toJSON())}toJSON(){return{_id:"FiberId",_tag:this._tag,id:this.id,startTimeMillis:this.startTimeMillis}}[A](){return this.toJSON()}}const _d=new gd,ta=t=>E(t,rn),ds=t=>{switch(t._tag){case er:return zt();case hs:return ui(t.id);case dd:return f(ds(t.left),nn(ds(t.right)))}},uo=M(Symbol.for("effect/Fiber/Id/_fiberCounter"),()=>Xc(0)),ea=t=>Array.from(ds(t)).map(n=>`#${n}`).join(","),yd=()=>{const t=Or(uo);return f(uo,Zc(t+1)),new md(t,Date.now())},be=_d,bd=ea,na=yd,fi=vr,Sd=Vh,kd=Jh,ra=Hh,sa=tn,ia=Jc,vd=oi,wd=Qh,oa=wr,sn=Symbol.for("effect/List"),ps=t=>B(t),Id=t=>_l(zs(t),ps),Ed=Id(v),Od={[sn]:sn,_tag:"Cons",toString(){return V(this.toJSON())},toJSON(){return{_id:"List",_tag:"Cons",values:ps(this).map(q)}},[A](){return this.toJSON()},[k](t){return aa(t)&&this._tag===t._tag&&Ed(this,t)},[w](){return N(this,fn(ps(this)))},[Symbol.iterator](){let t=!1,e=this;return{next(){if(t)return this.return();if(e._tag==="Nil")return t=!0,this.return();const n=e.head;return e=e.tail,{done:t,value:n}},return(n){return t||(t=!0),{done:!0,value:n}}}},pipe(){return y(this,arguments)}},nr=(t,e)=>{const n=Object.create(Od);return n.head=t,n.tail=e,n},$d=x("Nil"),Rd={[sn]:sn,_tag:"Nil",toString(){return V(this.toJSON())},toJSON(){return{_id:"List",_tag:"Nil"}},[A](){return this.toJSON()},[w](){return $d},[k](t){return aa(t)&&this._tag===t._tag},[Symbol.iterator](){return{next(){return{done:!0,value:void 0}}}},pipe(){return y(this,arguments)}},ca=Object.create(Rd),aa=t=>E(t,sn),Tt=t=>t._tag==="Nil",Md=t=>t._tag==="Cons",Td=()=>ca,Qt=(t,e)=>nr(t,e),Se=Td,hi=t=>nr(t,ca),Fd=u(2,(t,e)=>Nd(e,t)),Cd=u(2,(t,e)=>Qt(e,t)),Nd=u(2,(t,e)=>{if(Tt(t))return e;if(Tt(e))return t;{const n=nr(e.head,t);let r=n,s=e.tail;for(;!Tt(s);){const i=nr(s.head,t);r.tail=i,r=i,s=s.tail}return n}}),Ad=u(3,(t,e,n)=>{let r=e,s=t;for(;!Tt(s);)r=n(r,s.head),s=s.tail;return r}),Pd=t=>{let e=Se(),n=t;for(;!Tt(n);)e=Cd(e,n.head),n=n.tail;return e},di=(function(){function t(e){e&&Object.assign(this,e)}return t.prototype=Hs,t})(),xd=Symbol.for("effect/DifferContextPatch");function lo(t){return t}const gn={...di.prototype,[xd]:{_Value:lo,_Patch:lo}},Ld=Object.assign(Object.create(gn),{_tag:"Empty"}),jd=Object.create(Ld),ua=()=>jd,Dd=Object.assign(Object.create(gn),{_tag:"AndThen"}),qd=(t,e)=>{const n=Object.create(Dd);return n.first=t,n.second=e,n},Ud=Object.assign(Object.create(gn),{_tag:"AddService"}),Bd=(t,e)=>{const n=Object.create(Ud);return n.key=t,n.service=e,n},Vd=Object.assign(Object.create(gn),{_tag:"RemoveService"}),Kd=t=>{const e=Object.create(Vd);return e.key=t,e},Jd=Object.assign(Object.create(gn),{_tag:"UpdateService"}),Hd=(t,e)=>{const n=Object.create(Jd);return n.key=t,n.update=e,n},Gd=(t,e)=>{const n=new Map(t.unsafeMap);let r=ua();for(const[s,i]of e.unsafeMap.entries())if(n.has(s)){const o=n.get(s);n.delete(s),v(o,i)||(r=Dn(Hd(s,()=>i))(r))}else n.delete(s),r=Dn(Bd(s,i))(r);for(const[s]of n.entries())r=Dn(Kd(s))(r);return r},Dn=u(2,(t,e)=>qd(t,e)),Wd=u(2,(t,e)=>{if(t._tag==="Empty")return e;let n=!1,r=et(t);const s=new Map(e.unsafeMap);for(;ge(r);){const o=me(r),c=Ut(r);switch(o._tag){case"Empty":{r=c;break}case"AddService":{s.set(o.key,o.service),r=c;break}case"AndThen":{r=pt(pt(c,o.second),o.first);break}case"RemoveService":{s.delete(o.key),r=c;break}case"UpdateService":{s.set(o.key,o.update(s.get(o.key))),n=!0,r=c;break}}}if(!n)return de(s);const i=new Map;for(const[o]of e.unsafeMap)s.has(o)&&(i.set(o,s.get(o)),s.delete(o));for(const[o,c]of s)i.set(o,c);return de(i)}),Yd=Symbol.for("effect/DifferHashSetPatch");function Hr(t){return t}const $r={...di.prototype,[Yd]:{_Value:Hr,_Key:Hr,_Patch:Hr}},zd=Object.assign(Object.create($r),{_tag:"Empty"}),Qd=Object.create(zd),la=()=>Qd,Xd=Object.assign(Object.create($r),{_tag:"AndThen"}),Zd=(t,e)=>{const n=Object.create(Xd);return n.first=t,n.second=e,n},tp=Object.assign(Object.create($r),{_tag:"Add"}),ep=t=>{const e=Object.create(tp);return e.value=t,e},np=Object.assign(Object.create($r),{_tag:"Remove"}),rp=t=>{const e=Object.create(np);return e.value=t,e},sp=(t,e)=>{const[n,r]=tr([t,la()],([s,i],o)=>fd(o)(s)?[Qc(o)(s),i]:[s,gs(ep(o))(i)])(e);return tr(r,(s,i)=>gs(rp(i))(s))(n)},gs=u(2,(t,e)=>Zd(t,e)),ip=u(2,(t,e)=>{if(t._tag==="Empty")return e;let n=e,r=et(t);for(;ge(r);){const s=me(r),i=Ut(r);switch(s._tag){case"Empty":{r=i;break}case"AndThen":{r=pt(s.first)(pt(s.second)(i));break}case"Add":{n=Qe(s.value)(n),r=i;break}case"Remove":n=Qc(s.value)(n),r=i}}return n}),op=Symbol.for("effect/DifferReadonlyArrayPatch");function fo(t){return t}const mn={...di.prototype,[op]:{_Value:fo,_Patch:fo}},cp=Object.assign(Object.create(mn),{_tag:"Empty"}),ap=Object.create(cp),fa=()=>ap,up=Object.assign(Object.create(mn),{_tag:"AndThen"}),lp=(t,e)=>{const n=Object.create(up);return n.first=t,n.second=e,n},fp=Object.assign(Object.create(mn),{_tag:"Append"}),hp=t=>{const e=Object.create(fp);return e.values=t,e},dp=Object.assign(Object.create(mn),{_tag:"Slice"}),pp=(t,e)=>{const n=Object.create(dp);return n.from=t,n.until=e,n},gp=Object.assign(Object.create(mn),{_tag:"Update"}),mp=(t,e)=>{const n=Object.create(gp);return n.index=t,n.patch=e,n},_p=t=>{let e=0,n=fa();for(;e<t.oldValue.length&&e<t.newValue.length;){const r=t.oldValue[e],s=t.newValue[e],i=t.differ.diff(r,s);v(i,t.differ.empty)||(n=qn(n,mp(e,i))),e=e+1}return e<t.oldValue.length&&(n=qn(n,pp(0,e))),e<t.newValue.length&&(n=qn(n,hp(Ef(e)(t.newValue)))),n},qn=u(2,(t,e)=>lp(t,e)),yp=u(3,(t,e,n)=>{if(t._tag==="Empty")return e;let r=e.slice(),s=ft(t);for(;bf(s);){const i=X(s),o=fe(s);switch(i._tag){case"Empty":{s=o;break}case"AndThen":{o.unshift(i.first,i.second),s=o;break}case"Append":{for(const c of i.values)r.push(c);s=o;break}case"Slice":{r=r.slice(i.from,i.until),s=o;break}case"Update":{r[i.index]=n.patch(i.patch,r[i.index]),s=o;break}}}return r}),bp=Symbol.for("effect/Differ"),Sp={[bp]:{_P:U,_V:U},pipe(){return y(this,arguments)}},Fe=t=>{const e=Object.create(Sp);return e.empty=t.empty,e.diff=t.diff,e.combine=t.combine,e.patch=t.patch,e},kp=()=>Fe({empty:ua(),combine:(t,e)=>Dn(e)(t),diff:(t,e)=>Gd(t,e),patch:(t,e)=>Wd(e)(t)}),vp=()=>Fe({empty:la(),combine:(t,e)=>gs(e)(t),diff:(t,e)=>sp(t,e),patch:(t,e)=>ip(e)(t)}),wp=t=>Fe({empty:fa(),combine:(e,n)=>qn(e,n),diff:(e,n)=>_p({oldValue:e,newValue:n,differ:t}),patch:(e,n)=>yp(e,n,t)}),ha=()=>Ip((t,e)=>e),Ip=t=>Fe({empty:U,combine:(e,n)=>e===U?n:n===U?e:r=>n(e(r)),diff:(e,n)=>v(e,n)?U:dr(n),patch:(e,n)=>t(n,e(n))}),on=255,da=8,ms=t=>t&on,_s=t=>t>>da&on,_n=(t,e)=>(t&on)+((e&t&on)<<da),Ep=_n(0,0),Op=t=>_n(t,t),$p=t=>_n(t,0),Rp=u(2,(t,e)=>_n(ms(t)&~e,_s(t))),Mp=u(2,(t,e)=>t|e),Tp=t=>~t>>>0&on,Fp=0,Ce=1,Cp=2,pa=4,ys=16,ga=32,Np=t=>Rr(t,ga),Ap=u(2,(t,e)=>t|e),Nt=t=>ma(t)&&!xp(t),ma=t=>Rr(t,Ce),Rr=u(2,(t,e)=>(t&e)!==0),_a=(...t)=>t.reduce((e,n)=>e|n,0),Pp=_a(Fp),ho=t=>Rr(t,pa),xp=t=>Rr(t,ys),Un=u(2,(t,e)=>_n(t^e,e)),Bn=u(2,(t,e)=>t&(Tp(ms(e))|_s(e))|ms(e)&_s(e)),po=Fe({empty:Ep,diff:(t,e)=>Un(t,e),combine:(t,e)=>Mp(e)(t),patch:(t,e)=>Bn(e,t)}),Lp=Op,ya=$p,go=Rp,ba=(t,e)=>({_tag:"Par",left:t,right:e}),Fn=(t,e)=>({_tag:"Seq",left:t,right:e}),jp=t=>{let e=hi(t),n=Se();for(;;){const[r,s]=Ad(e,[Sa(),Se()],([i,o],c)=>{const[a,l]=Dp(c);return[Kp(i,a),Fd(o,l)]});if(n=qp(n,r),Tt(s))return Pd(n);e=s}throw new Error("BUG: BlockedRequests.flatten - please report an issue at https://github.com/Effect-TS/effect/issues")},Dp=t=>{let e=t,n=Sa(),r=Se(),s=Se();for(;;)switch(e._tag){case"Empty":{if(Tt(r))return[n,s];e=r.head,r=r.tail;break}case"Par":{r=Qt(e.right,r),e=e.left;break}case"Seq":{const i=e.left,o=e.right;switch(i._tag){case"Empty":{e=o;break}case"Par":{const c=i.left,a=i.right;e=ba(Fn(c,o),Fn(a,o));break}case"Seq":{const c=i.left,a=i.right;e=Fn(c,Fn(a,o));break}case"Single":{e=i,s=Qt(o,s);break}}break}case"Single":{if(n=Vp(n,e),Tt(r))return[n,s];e=r.head,r=r.tail;break}}throw new Error("BUG: BlockedRequests.step - please report an issue at https://github.com/Effect-TS/effect/issues")},qp=(t,e)=>{if(Tt(t))return hi(Gr(e));if(Jp(e))return t;const n=Qp(t.head),r=Hp(e);return n.length===1&&r.length===1&&v(n[0],r[0])?Qt(zp(t.head,Gr(e)),t.tail):Qt(Gr(e),t)},Up=Symbol.for("effect/RequestBlock/RequestBlockParallel"),Bp={_R:t=>t};class pi{map;[Up]=Bp;constructor(e){this.map=e}}const Sa=()=>new pi(fi()),Vp=(t,e)=>new pi(vd(t.map,e.dataSource,n=>cf(af(n,uh(e.blockedRequest)),()=>et(e.blockedRequest)))),Kp=(t,e)=>new pi(oa(t.map,e.map,(n,r,s)=>sa(n,s,Gs(ra(n,s),{onNone:()=>r,onSome:i=>ht(r,i)})))),Jp=t=>kd(t.map),Hp=t=>Array.from(ia(t.map)),Gr=t=>Yp(wd(t.map,e=>et(e))),Gp=Symbol.for("effect/RequestBlock/RequestBlockSequential"),Wp={_R:t=>t};class ka{map;[Gp]=Wp;constructor(e){this.map=e}}const Yp=t=>new ka(t),zp=(t,e)=>new ka(oa(e.map,t.map,(n,r,s)=>sa(n,s,Gs(ra(n,s),{onNone:()=>Ft(),onSome:i=>ht(i,r)})))),Qp=t=>Array.from(ia(t.map)),Xp=t=>Array.from(t.map),yn="Die",Xt="Empty",Ne="Fail",Ae="Interrupt",ke="Parallel",ve="Sequential",va="effect/Cause",wa=Symbol.for(va),Zp={_E:t=>t},Pe={[wa]:Zp,[w](){return f(_(va),O(_(hg(this))),N(this))},[k](t){return tg(t)&&fg(this,t)},pipe(){return y(this,arguments)},toJSON(){switch(this._tag){case"Empty":return{_id:"Cause",_tag:this._tag};case"Die":return{_id:"Cause",_tag:this._tag,defect:q(this.defect)};case"Interrupt":return{_id:"Cause",_tag:this._tag,fiberId:this.fiberId.toJSON()};case"Fail":return{_id:"Cause",_tag:this._tag,failure:q(this.error)};case"Sequential":case"Parallel":return{_id:"Cause",_tag:this._tag,left:q(this.left),right:q(this.right)}}},toString(){return bn(this)},[A](){return this.toJSON()}},we=(()=>{const t=Object.create(Pe);return t._tag=Xt,t})(),rr=t=>{const e=Object.create(Pe);return e._tag=Ne,e.error=t,e},St=t=>{const e=Object.create(Pe);return e._tag=yn,e.defect=t,e},At=t=>{const e=Object.create(Pe);return e._tag=Ae,e.fiberId=t,e},Mr=(t,e)=>{const n=Object.create(Pe);return n._tag=ke,n.left=t,n.right=e,n},ot=(t,e)=>{const n=Object.create(Pe);return n._tag=ve,n.left=t,n.right=e,n},tg=t=>E(t,wa),eg=t=>t._tag===Xt,ng=t=>t._tag===Xt?!0:Ie(t,!0,(e,n)=>{switch(n._tag){case Xt:return R(e);case yn:case Ne:case Ae:return R(!1);default:return S()}}),rg=t=>kt(ug(t)),gi=t=>mi(void 0,pg)(t),sg=t=>pe(Ie(t,Ft(),(e,n)=>n._tag===Ne?R(f(e,pt(n.error))):S())),ig=t=>pe(Ie(t,Ft(),(e,n)=>n._tag===yn?R(f(e,pt(n.defect))):S())),og=t=>Ie(t,zt(),(e,n)=>n._tag===Ae?R(f(e,Qe(n.fiberId))):S()),cg=t=>Ia(t,e=>e._tag===Ne?R(e.error):S()),ag=t=>{const e=cg(t);switch(e._tag){case"None":return Mt(t);case"Some":return le(e.value)}},ug=t=>Ia(t,e=>e._tag===Ae?R(e.fiberId):S()),mo=t=>Ea(t,{onEmpty:we,onFail:()=>we,onDie:St,onInterrupt:At,onSequential:ot,onParallel:Mr}),lg=t=>Ea(t,{onEmpty:we,onFail:St,onDie:St,onInterrupt:At,onSequential:ot,onParallel:Mr}),fg=(t,e)=>{let n=et(t),r=et(e);for(;ge(n)&&ge(r);){const[s,i]=f(me(n),Ie([zt(),Ft()],([a,l],d)=>{const[h,p]=bs(d);return R([f(a,nn(h)),f(l,ht(p))])})),[o,c]=f(me(r),Ie([zt(),Ft()],([a,l],d)=>{const[h,p]=bs(d);return R([f(a,nn(h)),f(l,ht(p))])}));if(!v(s,o))return!1;n=i,r=c}return!0},hg=t=>dg(et(t),Ft()),dg=(t,e)=>{for(;;){const[n,r]=f(t,Ic([zt(),Ft()],([i,o],c)=>{const[a,l]=bs(c);return[f(i,nn(a)),f(o,ht(l))]})),s=zc(n)>0?f(e,pt(n)):e;if(lh(r))return pe(s);t=r,e=s}throw new Error(mr("Cause.flattenCauseLoop"))},Ia=u(2,(t,e)=>{const n=[t];for(;n.length>0;){const r=n.pop(),s=e(r);switch(s._tag){case"None":{switch(r._tag){case ve:case ke:{n.push(r.right),n.push(r.left);break}}break}case"Some":return s}}return S()}),bs=t=>{let e=t;const n=[];let r=zt(),s=Ft();for(;e!==void 0;)switch(e._tag){case Xt:{if(n.length===0)return[r,s];e=n.pop();break}case Ne:{if(r=Qe(r,Kr(e._tag,e.error)),n.length===0)return[r,s];e=n.pop();break}case yn:{if(r=Qe(r,Kr(e._tag,e.defect)),n.length===0)return[r,s];e=n.pop();break}case Ae:{if(r=Qe(r,Kr(e._tag,e.fiberId)),n.length===0)return[r,s];e=n.pop();break}case ve:{switch(e.left._tag){case Xt:{e=e.right;break}case ve:{e=ot(e.left.left,ot(e.left.right,e.right));break}case ke:{e=Mr(ot(e.left.left,e.right),ot(e.left.right,e.right));break}default:{s=pt(s,e.right),e=e.left;break}}break}case ke:{n.push(e.right),e=e.left;break}}throw new Error(mr("Cause.evaluateCauseLoop"))},pg={emptyCase:zi,failCase:Zr,dieCase:Zr,interruptCase:zi,sequentialCase:(t,e,n)=>e&&n,parallelCase:(t,e,n)=>e&&n},_o="SequentialCase",yo="ParallelCase",Ea=u(2,(t,{onDie:e,onEmpty:n,onFail:r,onInterrupt:s,onParallel:i,onSequential:o})=>mi(t,void 0,{emptyCase:()=>n,failCase:(c,a)=>r(a),dieCase:(c,a)=>e(a),interruptCase:(c,a)=>s(a),sequentialCase:(c,a,l)=>o(a,l),parallelCase:(c,a,l)=>i(a,l)})),Ie=u(3,(t,e,n)=>{let r=e,s=t;const i=[];for(;s!==void 0;){const o=n(r,s);switch(r=kt(o)?o.value:r,s._tag){case ve:{i.push(s.right),s=s.left;break}case ke:{i.push(s.right),s=s.left;break}default:{s=void 0;break}}s===void 0&&i.length>0&&(s=i.pop())}return r}),mi=u(3,(t,e,n)=>{const r=[t],s=[];for(;r.length>0;){const o=r.pop();switch(o._tag){case Xt:{s.push(Mt(n.emptyCase(e)));break}case Ne:{s.push(Mt(n.failCase(e,o.error)));break}case yn:{s.push(Mt(n.dieCase(e,o.defect)));break}case Ae:{s.push(Mt(n.interruptCase(e,o.fiberId)));break}case ve:{r.push(o.right),r.push(o.left),s.push(le({_tag:_o}));break}case ke:{r.push(o.right),r.push(o.left),s.push(le({_tag:yo}));break}}}const i=[];for(;s.length>0;){const o=s.pop();switch(o._tag){case"Left":{switch(o.left._tag){case _o:{const c=i.pop(),a=i.pop(),l=n.sequentialCase(e,c,a);i.push(l);break}case yo:{const c=i.pop(),a=i.pop(),l=n.parallelCase(e,c,a);i.push(l);break}}break}case"Right":{i.push(o.right);break}}}if(i.length===0)throw new Error("BUG: Cause.reduceWithContext - please report an issue at https://github.com/Effect-TS/effect/issues");return i.pop()}),bn=(t,e)=>gi(t)?"All fibers interrupted without errors.":$a(t).map(function(n){return e?.renderErrorCause!==!0||n.cause===void 0?n.stack:`${n.stack} {
${Oa(n.cause,"  ")}
}`}).join(`
`),Oa=(t,e)=>{const n=t.stack.split(`
`);let r=`${e}[cause]: ${n[0]}`;for(let s=1,i=n.length;s<i;s++)r+=`
${e}${n[s]}`;return t.cause&&(r+=` {
${Oa(t.cause,`${e}  `)}
${e}}`),r};class sr extends globalThis.Error{span=void 0;constructor(e){const n=typeof e=="object"&&e!==null,r=Error.stackTraceLimit;Error.stackTraceLimit=1,super(gg(e),n&&"cause"in e&&typeof e.cause<"u"?{cause:new sr(e.cause)}:void 0),this.message===""&&(this.message="An error has occurred"),Error.stackTraceLimit=r,this.name=e instanceof Error?e.name:"Error",n&&(Ee in e&&(this.span=e[Ee]),Object.keys(e).forEach(s=>{s in this||(this[s]=e[s])})),this.stack=yg(`${this.name}: ${this.message}`,e instanceof Error&&e.stack?e.stack:"",this.span)}}const gg=t=>{if(typeof t=="string")return t;if(typeof t=="object"&&t!==null&&t instanceof Error)return t.message;try{if(E(t,"toString")&&pr(t.toString)&&t.toString!==Object.prototype.toString&&t.toString!==globalThis.Array.prototype.toString)return t.toString()}catch{}return rc(t)},mg=/\((.*)\)/g,_g=M("effect/Tracer/spanToTrace",()=>new WeakMap),yg=(t,e,n)=>{const r=[t],s=e.startsWith(t)?e.slice(t.length).split(`
`):e.split(`
`);for(let i=1;i<s.length;i++){if(s[i].includes(" at new BaseEffectError")||s[i].includes(" at new YieldableError")){i++;continue}if(s[i].includes("Generator.next")||s[i].includes("effect_internal_function"))break;r.push(s[i].replace(/at .*effect_instruction_i.*\((.*)\)/,"at $1").replace(/EffectPrimitive\.\w+/,"<anonymous>"))}if(n){let i=n,o=0;for(;i&&i._tag==="Span"&&o<10;){const c=_g.get(i);if(typeof c=="function"){const a=c();if(typeof a=="string"){const l=a.matchAll(mg);let d=!1;for(const[,h]of l)d=!0,r.push(`    at ${i.name} (${h})`);d||r.push(`    at ${i.name} (${a.replace(/^at /,"")})`)}else r.push(`    at ${i.name}`)}else r.push(`    at ${i.name}`);i=Dt(i.parent),o++}}return r.join(`
`)},Ee=Symbol.for("effect/SpanAnnotation"),$a=t=>mi(t,void 0,{emptyCase:()=>[],dieCase:(e,n)=>[new sr(n)],failCase:(e,n)=>[new sr(n)],interruptCase:()=>[],parallelCase:(e,n,r)=>[...n,...r],sequentialCase:(e,n,r)=>[...n,...r]}),Tr="Pending",Ra="Done",bg="effect/Deferred",Sg=Symbol.for(bg),kg={_E:t=>t,_A:t=>t},vg=t=>({_tag:Tr,joiners:t}),wg=t=>({_tag:Ra,effect:t});class Sn{self;called=!1;constructor(e){this.self=e}next(e){return this.called?{value:e,done:!0}:(this.called=!0,{value:this.self,done:!1})}return(e){return{value:e,done:!0}}throw(e){throw e}[Symbol.iterator](){return new Sn(this.self)}}const Ma=(t,e)=>{const n=new Y("Blocked");return n.effect_instruction_i0=t,n.effect_instruction_i1=e,n},Ig=t=>{const e=new Y("RunBlocked");return e.effect_instruction_i0=t,e},Oe=Symbol.for("effect/Effect");class Eg{patch;op;_op=Ks;constructor(e,n){this.patch=e,this.op=n}}class Y{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[Oe]=ue;constructor(e){this._op=e}[k](e){return this===e}[w](){return N(this,qs(this))}pipe(){return y(this,arguments)}toJSON(){return{_id:"Effect",_op:this._op,effect_instruction_i0:q(this.effect_instruction_i0),effect_instruction_i1:q(this.effect_instruction_i1),effect_instruction_i2:q(this.effect_instruction_i2)}}toString(){return V(this.toJSON())}[A](){return this.toJSON()}[Symbol.iterator](){return new Sn(new ln(this))}}class Ta{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[Oe]=ue;constructor(e){this._op=e,this._tag=e}[k](e){return Ri(e)&&e._op==="Failure"&&v(this.effect_instruction_i0,e.effect_instruction_i0)}[w](){return f(x(this._tag),O(_(this.effect_instruction_i0)),N(this))}get cause(){return this.effect_instruction_i0}pipe(){return y(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,cause:this.cause.toJSON()}}toString(){return V(this.toJSON())}[A](){return this.toJSON()}[Symbol.iterator](){return new Sn(new ln(this))}}class Fa{_op;effect_instruction_i0=void 0;effect_instruction_i1=void 0;effect_instruction_i2=void 0;trace=void 0;[Oe]=ue;constructor(e){this._op=e,this._tag=e}[k](e){return Ri(e)&&e._op==="Success"&&v(this.effect_instruction_i0,e.effect_instruction_i0)}[w](){return f(x(this._tag),O(_(this.effect_instruction_i0)),N(this))}get value(){return this.effect_instruction_i0}pipe(){return y(this,arguments)}toJSON(){return{_id:"Exit",_tag:this._op,value:q(this.value)}}toString(){return V(this.toJSON())}[A](){return this.toJSON()}[Symbol.iterator](){return new Sn(new ln(this))}}const _i=t=>E(t,Oe),gt=t=>{const e=new Y(oc);return e.effect_instruction_i0=t,e},Og=u(3,(t,e,n)=>Fr(r=>I(t,s=>I(Na(H(()=>r(e(s)))),i=>H(()=>n(s,i)).pipe($e({onFailure:o=>{switch(i._tag){case at:return mt(ot(i.effect_instruction_i0,o));case ut:return mt(o)}},onSuccess:()=>i})))))),xe=u(2,(t,e)=>I(t,()=>C(e))),kn=t=>xe(t,void 0),Ca=function(){const t=new Y(yr);switch(arguments.length){case 2:{t.effect_instruction_i0=arguments[0],t.commit=arguments[1];break}case 3:{t.effect_instruction_i0=arguments[0],t.effect_instruction_i1=arguments[1],t.commit=arguments[2];break}case 4:{t.effect_instruction_i0=arguments[0],t.effect_instruction_i1=arguments[1],t.effect_instruction_i2=arguments[2],t.commit=arguments[3];break}default:throw new Error(mr("you're not supposed to end up here"))}return t},ir=(t,e=be)=>{const n=new Y(Ye);let r;return n.effect_instruction_i0=s=>{r=t(s)},n.effect_instruction_i1=e,Da(n,s=>_i(r)?r:vt)},$g=(t,e=be)=>H(()=>ir(t,e)),cn=(t,e=be)=>Ca(t,function(){let n,r;function s(a){n?n(a):r===void 0&&(r=a)}const i=new Y(Ye);i.effect_instruction_i0=a=>{n=a,r&&a(r)},i.effect_instruction_i1=e;let o,c;return this.effect_instruction_i0.length!==1?(c=new AbortController,o=G(()=>this.effect_instruction_i0(s,c.signal))):o=G(()=>this.effect_instruction_i0(s)),o||c?Da(i,a=>(c&&c.abort(),o??vt)):i}),Ss=u(2,(t,e)=>bi(t,{onFailure:e,onSuccess:C})),bo=Symbol.for("effect/OriginalAnnotation"),yi=(t,e)=>kt(e)?new Proxy(t,{has(n,r){return r===Ee||r===bo||r in n},get(n,r){return r===Ee?e.value:r===bo?t:n[r]}}):t,So=t=>gr(t)&&!(Ee in t)?gt(e=>mt(St(yi(t,Mi(e))))):mt(St(t)),Rg=t=>Mg(()=>St(new nm(t))),ks=t=>bi(t,{onFailure:e=>C(le(e)),onSuccess:e=>C(Mt(e))}),Na=t=>Fg(t,{onFailure:T,onSuccess:j}),z=t=>gr(t)&&!(Ee in t)?gt(e=>mt(rr(yi(t,Mi(e))))):mt(rr(t)),Aa=t=>I(b(t),z),mt=t=>{const e=new Ta(at);return e.effect_instruction_i0=t,e},Mg=t=>I(b(t),mt),Tg=gt(t=>C(t.id())),Pa=t=>gt(e=>t(e.id())),I=u(2,(t,e)=>{const n=new Y(Gn);return n.effect_instruction_i0=t,n.effect_instruction_i1=e,n}),xa=t=>I(t,U),Fg=u(2,(t,e)=>$e(t,{onFailure:n=>C(e.onFailure(n)),onSuccess:n=>C(e.onSuccess(n))})),$e=u(2,(t,e)=>{const n=new Y(Wn);return n.effect_instruction_i0=t,n.effect_instruction_i1=e.onFailure,n.effect_instruction_i2=e.onSuccess,n}),bi=u(2,(t,e)=>$e(t,{onFailure:n=>{if(ig(n).length>0)return mt(lg(n));const s=sg(n);return s.length>0?e.onFailure(Pc(s)):mt(n)},onSuccess:e.onSuccess})),Bt=u(2,(t,e)=>H(()=>{const n=B(t),r=Ys(n.length);let s=0;return xe(wi({while:()=>s<n.length,body:()=>e(n[s],s),step:i=>{r[s++]=i}}),r)})),Si=u(2,(t,e)=>H(()=>{const n=B(t);let r=0;return wi({while:()=>r<n.length,body:()=>e(n[r],r),step:()=>{r++}})})),La=t=>{const e=new Y(hn);return e.effect_instruction_i0=Lp(Ce),e.effect_instruction_i1=()=>t,e},ct=u(2,(t,e)=>I(t,n=>b(()=>e(n)))),ja=u(2,(t,e)=>bi(t,{onFailure:n=>Aa(()=>e.onFailure(n)),onSuccess:n=>b(()=>e.onSuccess(n))})),ki=u(2,(t,e)=>$e(t,{onFailure:n=>{const r=ag(n);switch(r._tag){case"Left":return Aa(()=>e(r.left));case"Right":return mt(r.right)}},onSuccess:C})),vi=u(2,(t,e)=>Fr(n=>$e(n(t),{onFailure:r=>{const s=T(r);return $e(e(s),{onFailure:i=>T(ot(r,i)),onSuccess:()=>s})},onSuccess:r=>{const s=j(r);return Ka(e(s),s)}}))),Da=u(2,(t,e)=>vi(t,eu({onFailure:n=>gi(n)?kn(e(og(n))):vt,onSuccess:()=>vt}))),C=t=>{const e=new Fa(ut);return e.effect_instruction_i0=t,e},H=t=>{const e=new Y(yr);return e.commit=t,e},b=t=>{const e=new Y(ic);return e.effect_instruction_i0=t,e},qa=u(t=>t.length===3||t.length===2&&!(gr(t[1])&&"onlyEffect"in t[1]),(t,e)=>I(t,n=>{const r=typeof e=="function"?e(n):e;return _i(r)?xe(r,n):vl(r)?ir(s=>{r.then(i=>s(C(n)),i=>s(z(new tu(i,"An unknown error occurred in Effect.tap"))))}):C(n)})),Cg=t=>gt(e=>{const n=e.getFiberRef(ws),r=f(n,Wt(()=>e.scope()));return t($i(ws,R(r)))}),Ua=t=>{const e=new Y(hn);return e.effect_instruction_i0=ya(Ce),e.effect_instruction_i1=()=>t,e},Fr=t=>Ca(t,function(){const e=new Y(hn);return e.effect_instruction_i0=ya(Ce),e.effect_instruction_i1=n=>ma(n)?G(()=>this.effect_instruction_i0(La)):G(()=>this.effect_instruction_i0(Ua)),e}),vt=C(void 0),Ng=t=>{const e=new Y(hn);return e.effect_instruction_i0=t,e.effect_instruction_i1=void 0,e},wi=t=>{const e=new Y(Yn);return e.effect_instruction_i0=t.while,e.effect_instruction_i1=t.body,e.effect_instruction_i2=t.step,e},Ii=t=>{const e=new Y(Ln);return typeof t?.priority<"u"?zg(e,t.priority):e},Ba=u(2,(t,e)=>I(t,n=>ct(e,r=>[n,r]))),Va=u(2,(t,e)=>I(t,n=>xe(e,n))),Ka=u(2,(t,e)=>I(t,()=>e)),Ag=t=>I(Tg,e=>f(t,Ja(e))),Ja=u(2,(t,e)=>I(t.interruptAsFork(e),()=>t.await)),Pg={_tag:"All",syslog:0,label:"ALL",ordinal:Number.MIN_SAFE_INTEGER,pipe(){return y(this,arguments)}},xg={_tag:"Fatal",syslog:2,label:"FATAL",ordinal:5e4,pipe(){return y(this,arguments)}},Lg={_tag:"Error",syslog:3,label:"ERROR",ordinal:4e4,pipe(){return y(this,arguments)}},Ha={_tag:"Warning",syslog:4,label:"WARN",ordinal:3e4,pipe(){return y(this,arguments)}},Ga={_tag:"Info",syslog:6,label:"INFO",ordinal:2e4,pipe(){return y(this,arguments)}},Wa={_tag:"Debug",syslog:7,label:"DEBUG",ordinal:1e4,pipe(){return y(this,arguments)}},jg={_tag:"Trace",syslog:7,label:"TRACE",ordinal:0,pipe(){return y(this,arguments)}},Dg={_tag:"None",syslog:7,label:"OFF",ordinal:Number.MAX_SAFE_INTEGER,pipe(){return y(this,arguments)}},qg="effect/FiberRef",Ug=Symbol.for(qg),Bg={_A:t=>t},Ei=t=>gt(e=>j(e.getFiberRef(t))),Oi=u(2,(t,e)=>I(Ei(t),e)),ko=u(2,(t,e)=>Vg(t,()=>[void 0,e])),Vg=u(2,(t,e)=>gt(n=>{const[r,s]=e(n.getFiberRef(t));return n.setFiberRef(t,s),C(r)})),$i=u(3,(t,e,n)=>Og(Va(Ei(e),ko(e,n)),()=>t,r=>ko(e,r))),lt=(t,e)=>Le(t,{differ:ha(),fork:e?.fork??U,join:e?.join}),Kg=t=>{const e=vp();return Le(t,{differ:e,fork:e.empty})},Jg=t=>{const e=wp(ha());return Le(t,{differ:e,fork:e.empty})},Ya=t=>{const e=kp();return Le(t,{differ:e,fork:e.empty})},Le=(t,e)=>({...pn,[Ug]:Bg,initial:t,commit(){return Ei(this)},diff:(r,s)=>e.differ.diff(r,s),combine:(r,s)=>e.differ.combine(r,s),patch:r=>s=>e.differ.patch(r,s),fork:e.fork,join:e.join??((r,s)=>s)}),Hg=t=>Le(t,{differ:po,fork:po.empty}),Cr=M(Symbol.for("effect/FiberRef/currentContext"),()=>Ya(Xs())),Nr=M(Symbol.for("effect/FiberRef/currentSchedulingPriority"),()=>lt(0)),za=M(Symbol.for("effect/FiberRef/currentMaxOpsBeforeYield"),()=>lt(2048)),Gg=M(Symbol.for("effect/FiberRef/currentLogAnnotation"),()=>lt(fi())),Wg=M(Symbol.for("effect/FiberRef/currentLogLevel"),()=>lt(Ga)),Yg=M(Symbol.for("effect/FiberRef/currentLogSpan"),()=>lt(Se())),zg=u(2,(t,e)=>$i(t,Nr,e)),Qg=M(Symbol.for("effect/FiberRef/currentUnhandledErrorLogLevel"),()=>lt(R(Wa))),Xg=M(Symbol.for("effect/FiberRef/versionMismatchErrorLogLevel"),()=>lt(R(Ha))),vs=M(Symbol.for("effect/FiberRef/currentMetricLabels"),()=>Jg(he())),ws=M(Symbol.for("effect/FiberRef/currentForkScopeOverride"),()=>lt(S(),{fork:()=>S(),join:(t,e)=>t})),Cn=M(Symbol.for("effect/FiberRef/currentInterruptedCause"),()=>lt(we,{fork:()=>we,join:(t,e)=>t})),Zg=(t,e)=>t.addFinalizer(()=>kn(e)),tm=(t,e)=>t.close(e),em=(t,e)=>t.fork(e),Qa=(function(){class t extends globalThis.Error{commit(){return z(this)}toJSON(){const n={...this};return this.message&&(n.message=this.message),this.cause&&(n.cause=this.cause),n}[A](){return this.toString!==globalThis.Error.prototype.toString?this.stack?`${this.toString()}
${this.stack.split(`
`).slice(1).join(`
`)}`:this.toString():"Bun"in globalThis?bn(rr(this),{renderErrorCause:!0}):this}}return Object.assign(t.prototype,Hl),t})(),Xa=(t,e)=>{class n extends Qa{_tag=e}return Object.assign(n.prototype,t),n.prototype.name=e,n},vo=Symbol.for("effect/Cause/errors/RuntimeException"),nm=Xa({[vo]:vo},"RuntimeException"),rm=Symbol.for("effect/Cause/errors/InterruptedException"),sm=t=>E(t,rm),wo=Symbol.for("effect/Cause/errors/NoSuchElement"),Za=Xa({[wo]:wo},"NoSuchElementException"),Io=Symbol.for("effect/Cause/errors/UnknownException"),tu=(function(){class t extends Qa{_tag="UnknownException";error;constructor(n,r){super(r??"An unknown error occurred",{cause:n}),this.error=n}}return Object.assign(t.prototype,{[Io]:Io,name:"UnknownException"}),t})(),Ri=t=>_i(t)&&"_tag"in t&&(t._tag==="Success"||t._tag==="Failure"),Eo=(t,e)=>am(t,e?.parallel?Mr:ot),im=t=>T(St(t)),Oo=t=>T(rr(t)),T=t=>{const e=new Ta(at);return e.effect_instruction_i0=t,e},om=t=>T(At(t)),Wr=u(2,(t,e)=>{switch(t._tag){case at:return T(t.effect_instruction_i0);case ut:return j(e(t.effect_instruction_i0))}}),eu=u(2,(t,{onFailure:e,onSuccess:n})=>{switch(t._tag){case at:return e(t.effect_instruction_i0);case ut:return n(t.effect_instruction_i0)}}),j=t=>{const e=new Fa(ut);return e.effect_instruction_i0=t,e},Vt=j(void 0),cm=u(3,(t,e,{onFailure:n,onSuccess:r})=>{switch(t._tag){case at:switch(e._tag){case ut:return T(t.effect_instruction_i0);case at:return T(n(t.effect_instruction_i0,e.effect_instruction_i0))}case ut:switch(e._tag){case ut:return j(r(t.effect_instruction_i0,e.effect_instruction_i0));case at:return T(e.effect_instruction_i0)}}}),am=(t,e)=>{const n=Ac(t);return ge(n)?f(Ut(n),Ic(f(me(n),Wr(et)),(r,s)=>f(r,cm(s,{onSuccess:(i,o)=>f(i,pt(o)),onFailure:e}))),Wr(pe),Wr(r=>Ht(r)),R):S()},um=t=>({...pn,[Sg]:kg,state:Xc(vg([])),commit(){return nu(this)},blockingOn:t}),nu=t=>$g(e=>{const n=Or(t.state);switch(n._tag){case Ra:return e(n.effect);case Tr:return n.joiners.push(e),lm(t,e)}},t.blockingOn),ru=(t,e)=>{const n=Or(t.state);if(n._tag===Tr){Zc(t.state,wg(e));for(let r=0,s=n.joiners.length;r<s;r++)n.joiners[r](e)}},lm=(t,e)=>b(()=>{const n=Or(t.state);if(n._tag===Tr){const r=n.joiners.indexOf(e);r>=0&&n.joiners.splice(r,1)}}),Mi=t=>{const e=t.currentSpan;return e!==void 0&&e._tag==="Span"?R(e):S()},$o=Symbol.for("effect/MutableHashMap"),fm={[$o]:$o,[Symbol.iterator](){return new Ti(this)},toString(){return V(this.toJSON())},toJSON(){return{_id:"MutableHashMap",values:Array.from(this).map(q)}},[A](){return this.toJSON()},pipe(){return y(this,arguments)}};class Ti{self;referentialIterator;bucketIterator;constructor(e){this.self=e,this.referentialIterator=e.referential[Symbol.iterator]()}next(){if(this.bucketIterator!==void 0)return this.bucketIterator.next();const e=this.referentialIterator.next();return e.done?(this.bucketIterator=new hm(this.self.buckets.values()),this.next()):e}[Symbol.iterator](){return new Ti(this.self)}}class hm{backing;constructor(e){this.backing=e}currentBucket;next(){if(this.currentBucket===void 0){const n=this.backing.next();if(n.done)return n;this.currentBucket=n.value[Symbol.iterator]()}const e=this.currentBucket.next();return e.done?(this.currentBucket=void 0,this.next()):e}}const dm=()=>{const t=Object.create(fm);return t.referential=new Map,t.buckets=new Map,t.bucketsSize=0,t},qt=u(2,(t,e)=>{if(Hn(e)===!1)return t.referential.has(e)?R(t.referential.get(e)):S();const n=e[w](),r=t.buckets.get(n);return r===void 0?S():pm(t,r,e)}),pm=(t,e,n,r=!1)=>{for(let s=0,i=e.length;s<i;s++)if(n[k](e[s][0])){const o=e[s][1];return r&&(e.splice(s,1),t.bucketsSize--),R(o)}return S()},Ke=u(2,(t,e)=>kt(qt(t,e))),Je=u(3,(t,e,n)=>{if(Hn(e)===!1)return t.referential.set(e,n),t;const r=e[w](),s=t.buckets.get(r);return s===void 0?(t.buckets.set(r,[[e,n]]),t.bucketsSize++,t):(gm(t,s,e),s.push([e,n]),t.bucketsSize++,t)}),gm=(t,e,n)=>{for(let r=0,s=e.length;r<s;r++)if(n[k](e[r][0])){e.splice(r,1),t.bucketsSize--;return}},mm="effect/Clock",Ro=Symbol.for(mm),Fi=Te("effect/Clock"),_m=2**31-1,Mo={unsafeSchedule(t,e){const n=as(e);if(n>_m)return Zr;let r=!1;const s=setTimeout(()=>{r=!0,t()},n);return()=>(clearTimeout(s),!r)}},To=(function(){const t=BigInt(1e6);if(typeof performance>"u")return()=>BigInt(Date.now())*t;let e;return()=>(e===void 0&&(e=BigInt(Date.now())*t-BigInt(Math.round(performance.now()*1e6))),e+BigInt(Math.round(performance.now()*1e6)))})(),ym=(function(){const t=typeof process=="object"&&"hrtime"in process&&typeof process.hrtime.bigint=="function"?process.hrtime:void 0;if(!t)return To;const e=To()-t.bigint();return()=>e+t.bigint()})();class bm{[Ro]=Ro;unsafeCurrentTimeMillis(){return Date.now()}unsafeCurrentTimeNanos(){return ym()}currentTimeMillis=b(()=>this.unsafeCurrentTimeMillis());currentTimeNanos=b(()=>this.unsafeCurrentTimeNanos());scheduler(){return C(Mo)}sleep(e){return cn(n=>{const r=Mo.unsafeSchedule(()=>n(vt),e);return kn(b(r))})}}const Sm=()=>new bm,su="And",iu="Or",ou="InvalidData",cu="MissingData",au="SourceUnavailable",uu="Unsupported",km="effect/ConfigError",Fo=Symbol.for(km),je={_tag:"ConfigError",[Fo]:Fo},lu=(t,e)=>{const n=Object.create(je);return n._op=su,n.left=t,n.right=e,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} and ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},fu=(t,e)=>{const n=Object.create(je);return n._op=iu,n.left=t,n.right=e,Object.defineProperty(n,"toString",{enumerable:!1,value(){return`${this.left} or ${this.right}`}}),Object.defineProperty(n,"message",{enumerable:!1,get(){return this.toString()}}),n},vm=(t,e,n={pathDelim:"."})=>{const r=Object.create(je);return r._op=ou,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Invalid data at ${f(this.path,Me(n.pathDelim))}: "${this.message}")`}}),r},Zt=(t,e,n={pathDelim:"."})=>{const r=Object.create(je);return r._op=cu,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Missing data at ${f(this.path,Me(n.pathDelim))}: "${this.message}")`}}),r},wm=(t,e,n,r={pathDelim:"."})=>{const s=Object.create(je);return s._op=au,s.path=t,s.message=e,s.cause=n,Object.defineProperty(s,"toString",{enumerable:!1,value(){return`(Source unavailable at ${f(this.path,Me(r.pathDelim))}: "${this.message}")`}}),s},Im=(t,e,n={pathDelim:"."})=>{const r=Object.create(je);return r._op=uu,r.path=t,r.message=e,Object.defineProperty(r,"toString",{enumerable:!1,value(){return`(Unsupported operation at ${f(this.path,Me(n.pathDelim))}: "${this.message}")`}}),r},Kt=u(2,(t,e)=>{switch(t._op){case su:return lu(Kt(t.left,e),Kt(t.right,e));case iu:return fu(Kt(t.left,e),Kt(t.right,e));case ou:return vm([...e,...t.path],t.message);case cu:return Zt([...e,...t.path],t.message);case au:return wm([...e,...t.path],t.message,t.cause);case uu:return Im([...e,...t.path],t.message)}}),Em={_tag:"Empty"},Yr=u(2,(t,e)=>{let n=hi(e),r=t;for(;Md(n);){const s=n.head;switch(s._tag){case"Empty":{n=n.tail;break}case"AndThen":{n=Qt(s.first,Qt(s.second,n.tail));break}case"MapName":{r=se(r,s.f),n=n.tail;break}case"Nested":{r=zn(r,s.name),n=n.tail;break}case"Unnested":{if(f(ze(r),hf(s.name)))r=fe(r),n=n.tail;else return le(Zt(r,`Expected ${s.name} to be in path in ConfigProvider#unnested`));break}}}return Mt(r)}),Om="Constant",$m="Fail",Rm="Fallback",Mm="Described",Tm="Lazy",Fm="MapOrFail",Cm="Nested",Nm="Primitive",Am="Sequence",Pm="HashMap",xm="ZipWith",or=(t,e)=>[...t,...e],Lm="effect/ConfigProvider",Co=Symbol.for(Lm),jm=Te("effect/ConfigProvider"),Dm="effect/ConfigProviderFlat",No=Symbol.for(Dm),qm=t=>({[Co]:Co,pipe(){return y(this,arguments)},...t}),Um=t=>({[No]:No,patch:t.patch,load:(e,n,r=!0)=>t.load(e,n,r),enumerateChildren:t.enumerateChildren}),Bm=t=>qm({load:e=>I(it(t,he(),e,!1),n=>Gs(ze(n),{onNone:()=>z(Zt(he(),`Expected a single value having structure: ${e}`)),onSome:C})),flattened:t}),Vm=t=>{const{pathDelim:e,seqDelim:n}=Object.assign({},{pathDelim:"_",seqDelim:","},t),r=a=>f(a,Me(e)),s=a=>a.split(e),i=()=>typeof process<"u"&&"env"in process&&typeof process.env=="object"?process.env:{};return Bm(Um({load:(a,l,d=!0)=>{const h=r(a),p=i(),g=h in p?R(p[h]):S();return f(g,ki(()=>Zt(a,`Expected ${h} to exist in the process context`)),I(m=>Wm(m,a,l,n,d)))},enumerateChildren:a=>b(()=>{const l=i(),p=Object.keys(l).map(g=>s(g.toUpperCase())).filter(g=>{for(let m=0;m<a.length;m++){const $=f(a,vc(m)),F=g[m];if(F===void 0||$!==F)return!1}return!0}).flatMap(g=>g.slice(a.length,a.length+1));return ld(p)}),patch:Em}))},Km=(t,e,n,r)=>{const s=eo(n.length,a=>a>=r.length?S():R([t(a),a+1])),i=eo(r.length,a=>a>=n.length?S():R([e(a),a+1])),o=or(n,s),c=or(r,i);return[o,c]},Jm=(t,e)=>{let n=e;if(n._tag==="Nested"){const r=t.slice();for(;n._tag==="Nested";)r.push(n.name),n=n.config;return r}return t},it=(t,e,n,r)=>{const s=n;switch(s._tag){case Om:return C(ft(s.value));case Mm:return H(()=>it(t,e,s.config,r));case $m:return z(Zt(e,s.message));case Rm:return f(H(()=>it(t,e,s.first,r)),Ss(i=>s.condition(i)?f(it(t,e,s.second,r),Ss(o=>z(fu(i,o)))):z(i)));case Tm:return H(()=>it(t,e,s.config(),r));case Fm:return H(()=>f(it(t,e,s.original,r),I(Bt(i=>f(s.mapOrFail(i),ki(Kt(Jm(e,s.original))))))));case Cm:return H(()=>it(t,or(e,ft(s.name)),s.config,r));case Nm:return f(Yr(e,t.patch),I(i=>f(t.load(i,s,r),I(o=>{if(o.length===0){const c=f(vf(i),Wt(()=>"<n/a>"));return z(Zt([],`Expected ${s.description} with name ${c}`))}return C(o)}))));case Am:return f(Yr(e,t.patch),I(i=>f(t.enumerateChildren(i),I(zm),I(o=>o.length===0?H(()=>ct(it(t,e,s.config,!0),ft)):f(Bt(o,c=>it(t,mf(e,`[${c}]`),s.config,!0)),ct(c=>{const a=Nf(c);return a.length===0?ft(he()):ft(a)}))))));case Pm:return H(()=>f(Yr(e,t.patch),I(i=>f(t.enumerateChildren(i),I(o=>f(o,Bt(c=>it(t,or(i,ft(c)),s.valueConfig,r)),ct(c=>c.length===0?ft(fi()):f(Ym(c),se(a=>Sd(to(B(o),a)))))))))));case xm:return H(()=>f(it(t,e,s.left,r),ks,I(i=>f(it(t,e,s.right,r),ks,I(o=>{if(We(i)&&We(o))return z(lu(i.left,o.left));if(We(i)&&Mn(o))return z(i.left);if(Mn(i)&&We(o))return z(o.left);if(Mn(i)&&Mn(o)){const c=f(e,Me(".")),a=Hm(e,c),[l,d]=Km(a,a,f(i.right,se(Mt)),f(o.right,se(Mt)));return f(l,to(d),Bt(([h,p])=>f(Ba(h,p),ct(([g,m])=>s.zip(g,m)))))}throw new Error("BUG: ConfigProvider.fromFlatLoop - please report an issue at https://github.com/Effect-TS/effect/issues")})))))}},Hm=(t,e)=>n=>le(Zt(t,`The element at index ${n} in a sequence at path "${e}" was missing`)),Gm=(t,e)=>t.split(new RegExp(`\\s*${Pf(e)}\\s*`)),Wm=(t,e,n,r,s)=>s?f(Gm(t,r),Bt(i=>n.parse(i.trim())),ki(Kt(e))):f(n.parse(t),ja({onFailure:Kt(e),onSuccess:ft})),Ym=t=>Object.keys(t[0]).map(e=>t.map(n=>n[e])),zm=t=>f(Bt(t,Xm),ja({onFailure:()=>he(),onSuccess:Qn(Ze)}),ks,ct(nf)),Qm=/^(\[(\d+)\])$/,Xm=t=>{const e=t.match(Qm);if(e!==null){const n=e[2];return f(n!==void 0&&n.length>0?R(n):S(),uf(Zm))}return S()},Zm=t=>{const e=Number.parseInt(t);return Number.isNaN(e)?S():R(e)},Ao=Symbol.for("effect/Console"),Ci=Te("effect/Console"),t_={[Ao]:Ao,assert(t,...e){return b(()=>{console.assert(t,...e)})},clear:b(()=>{console.clear()}),count(t){return b(()=>{console.count(t)})},countReset(t){return b(()=>{console.countReset(t)})},debug(...t){return b(()=>{console.debug(...t)})},dir(t,e){return b(()=>{console.dir(t,e)})},dirxml(...t){return b(()=>{console.dirxml(...t)})},error(...t){return b(()=>{console.error(...t)})},group(t){return t?.collapsed?b(()=>console.groupCollapsed(t?.label)):b(()=>console.group(t?.label))},groupEnd:b(()=>{console.groupEnd()}),info(...t){return b(()=>{console.info(...t)})},log(...t){return b(()=>{console.log(...t)})},table(t,e){return b(()=>{console.table(t,e)})},time(t){return b(()=>console.time(t))},timeEnd(t){return b(()=>console.timeEnd(t))},timeLog(t,...e){return b(()=>{console.timeLog(t,...e)})},trace(...t){return b(()=>{console.trace(...t)})},warn(...t){return b(()=>{console.warn(...t)})},unsafe:console},e_="effect/Random",Po=Symbol.for(e_),n_=Te("effect/Random");class r_{seed;[Po]=Po;PRNG;constructor(e){this.seed=e,this.PRNG=new Ml(e)}get next(){return b(()=>this.PRNG.number())}get nextBoolean(){return ct(this.next,e=>e>.5)}get nextInt(){return b(()=>this.PRNG.integer(Number.MAX_SAFE_INTEGER))}nextRange(e,n){return ct(this.next,r=>(n-e)*r+e)}nextIntBetween(e,n){return b(()=>this.PRNG.integer(n-e)+e)}shuffle(e){return s_(e,n=>this.nextIntBetween(0,n))}}const s_=(t,e)=>H(()=>f(b(()=>Array.from(t)),I(n=>{const r=[];for(let s=n.length;s>=2;s=s-1)r.push(s);return f(r,Si(s=>f(e(s),ct(i=>i_(n,s-1,i)))),xe(Ac(n)))}))),i_=(t,e,n)=>{const r=t[e];return t[e]=t[n],t[n]=r,t},o_=t=>new r_(_(t)),xo=Symbol.for("effect/Tracer"),c_=t=>({[xo]:xo,...t}),hu=Te("effect/Tracer"),du=Te("effect/ParentSpan"),Lo=(function(){const t="abcdef0123456789",e=t.length;return function(n){let r="";for(let s=0;s<n;s++)r+=t.charAt(Math.floor(Math.random()*e));return r}})();class a_{name;parent;context;startTime;kind;_tag="Span";spanId;traceId="native";sampled=!0;status;attributes;events=[];links;constructor(e,n,r,s,i,o){this.name=e,this.parent=n,this.context=r,this.startTime=i,this.kind=o,this.status={_tag:"Started",startTime:i},this.attributes=new Map,this.traceId=n._tag==="Some"?n.value.traceId:Lo(32),this.spanId=Lo(16),this.links=Array.from(s)}end(e,n){this.status={_tag:"Ended",endTime:e,exit:n,startTime:this.status.startTime}}attribute(e,n){this.attributes.set(e,n)}event(e,n,r){this.events.push([e,n,r??{}])}addLinks(e){this.links.push(...e)}}const u_=c_({span:(t,e,n,r,s,i)=>new a_(t,e,n,r,s,i),context:t=>t()}),l_=f(Xs(),Ve(Fi,Sm()),Ve(Ci,t_),Ve(n_,o_(Math.random())),Ve(jm,Vm()),Ve(hu,u_)),an=M(Symbol.for("effect/DefaultServices/currentServices"),()=>Ya(l_));function f_(t){return new xt(t)}function h_(){return f_(new Map)}const jo=Symbol.for("effect/FiberRefs");class xt{locals;[jo]=jo;constructor(e){this.locals=e}pipe(){return y(this,arguments)}}const d_=(t,e,n,r=!1)=>{const s=t;let i=e,o=n,c=r,a;for(;a===void 0;)if(tt(i)&&tt(o)){const l=X(i)[0],d=fe(i),h=X(o)[0],p=X(o)[1],g=fe(o);l.startTimeMillis<h.startTimeMillis?(o=g,c=!0):l.startTimeMillis>h.startTimeMillis?i=d:l.id<h.id?(o=g,c=!0):l.id>h.id?i=d:a=[p,c]}else a=[s.initial,!0];return a},p_=u(3,(t,e,n)=>{const r=new Map(t.locals);return n.locals.forEach((s,i)=>{const o=s[0][1];if(!s[0][0][k](e)){if(!r.has(i)){if(v(o,i.initial))return;r.set(i,[[e,i.join(i.initial,o)]]);return}const c=r.get(i),[a,l]=d_(i,c,s);if(l){const d=i.diff(a,o),h=c[0][1],p=i.join(h,i.patch(d)(h));if(!v(h,p)){let g;const m=c[0][0];m[k](e)?g=[[m,p],...c.slice(1)]:g=[[e,p],...c],r.set(i,g)}}}}),new xt(r)}),g_=u(2,(t,e)=>{const n=new Map;return pu(t,n,e),new xt(n)}),pu=(t,e,n)=>{t.locals.forEach((r,s)=>{const i=r[0][1],o=s.patch(s.fork)(i);v(i,o)?e.set(s,r):e.set(s,[[n,o],...r])})},gu=u(2,(t,e)=>{const n=new Map(t.locals);return n.delete(e),new xt(n)}),m_=u(2,(t,e)=>t.locals.has(e)?R(X(t.locals.get(e))[1]):S()),un=u(2,(t,e)=>f(m_(t,e),Wt(()=>e.initial))),Is=u(2,(t,{fiberId:e,fiberRef:n,value:r})=>{if(t.locals.size===0)return new xt(new Map([[n,[[e,r]]]]));const s=new Map(t.locals);return Es(s,e,n,r),new xt(s)}),Es=(t,e,n,r)=>{const s=t.get(n)??[];let i;if(tt(s)){const[o,c]=X(s);if(o[k](e)){if(v(c,r))return;i=[[e,r],...s.slice(1)]}else i=[[e,r],...s]}else i=[[e,r]];t.set(n,i)},__=u(2,(t,{entries:e,forkAs:n})=>{if(t.locals.size===0)return new xt(new Map(e));const r=new Map(t.locals);return n!==void 0&&pu(t,r,n),e.forEach(([s,i])=>{i.length===1?Es(r,i[0][0],s,i[0][1]):i.forEach(([o,c])=>{Es(r,o,s,c)})}),new xt(r)}),y_=un,b_=__,S_=h_,k_=Pg,v_=xg,w_=Lg,I_=Ha,E_=Ga,O_=Wa,$_=jg,R_=Dg,M_=f(Ze,sf(t=>t.ordinal)),T_=of(M_),F_=t=>{switch(t){case"All":return k_;case"Debug":return O_;case"Error":return w_;case"Fatal":return v_;case"Info":return E_;case"Trace":return $_;case"None":return R_;case"Warning":return I_}},mu=t=>t.replace(/[\s="]/g,"_"),C_=t=>e=>`${mu(e.label)}=${t-e.startTime}ms`,N_=dn,A_=Gl;class P_ extends A_{}const _u="Empty",yu="Add",bu="Remove",Su="Update",ku="AndThen",x_={_tag:_u},L_=(t,e)=>{const n=new Map(t.locals);let r=x_;for(const[s,i]of e.locals.entries()){const o=X(i)[1],c=n.get(s);if(c!==void 0){const a=X(c)[1];v(a,o)||(r=zr({_tag:Su,fiberRef:s,patch:s.diff(a,o)})(r))}else r=zr({_tag:yu,fiberRef:s,value:o})(r);n.delete(s)}for(const[s]of n.entries())r=zr({_tag:bu,fiberRef:s})(r);return r},zr=u(2,(t,e)=>({_tag:ku,first:t,second:e})),j_=u(3,(t,e,n)=>{let r=n,s=ft(t);for(;tt(s);){const i=X(s),o=fe(s);switch(i._tag){case _u:{s=o;break}case yu:{r=Is(r,{fiberId:e,fiberRef:i.fiberRef,value:i.value}),s=o;break}case bu:{r=gu(r,i.fiberRef),s=o;break}case Su:{const c=un(r,i.fiberRef);r=Is(r,{fiberId:e,fiberRef:i.fiberRef,value:i.fiberRef.patch(i.patch)(c)}),s=o;break}case ku:{s=zn(i.first)(zn(i.second)(o));break}}}return r}),vu="effect/MetricLabel",Os=Symbol.for(vu);class D_{key;value;[Os]=Os;_hash;constructor(e,n){this.key=e,this.value=n,this._hash=x(vu+this.key+this.value)}[w](){return this._hash}[k](e){return U_(e)&&this.key===e.key&&this.value===e.value}pipe(){return y(this,arguments)}}const q_=(t,e)=>new D_(t,e),U_=t=>E(t,Os),B_=t=>{let e,n;return typeof t=="function"?e=t:(e=t.try,n=t.catch),H(()=>{try{return C(G(e))}catch(r){return z(n?G(()=>n(r)):new tu(r,"An unknown error occurred in Effect.try"))}})},V_="Sequential",K_={_tag:V_},J_=L_,H_=j_,Ar="effect/FiberStatus",te=Symbol.for(Ar),cr="Done",Do="Running",qo="Suspended",G_=x(`${Ar}-${cr}`);class W_{[te]=te;_tag=cr;[w](){return G_}[k](e){return Ni(e)&&e._tag===cr}}class Y_{runtimeFlags;[te]=te;_tag=Do;constructor(e){this.runtimeFlags=e}[w](){return f(_(Ar),O(_(this._tag)),O(_(this.runtimeFlags)),N(this))}[k](e){return Ni(e)&&e._tag===Do&&this.runtimeFlags===e.runtimeFlags}}class z_{runtimeFlags;blockingOn;[te]=te;_tag=qo;constructor(e,n){this.runtimeFlags=e,this.blockingOn=n}[w](){return f(_(Ar),O(_(this._tag)),O(_(this.runtimeFlags)),O(_(this.blockingOn)),N(this))}[k](e){return Ni(e)&&e._tag===qo&&this.runtimeFlags===e.runtimeFlags&&v(this.blockingOn,e.blockingOn)}}const Q_=new W_,X_=t=>new Y_(t),Z_=(t,e)=>new z_(t,e),Ni=t=>E(t,te),ty=t=>t._tag===cr,ey=Q_,wu=X_,ny=Z_,ry=ty,sy=Symbol.for("effect/Micro"),ar=Symbol.for("effect/Micro/MicroExit"),Uo=Symbol.for("effect/Micro/MicroCause"),iy={_E:U};class Iu extends globalThis.Error{_tag;traces;[Uo];constructor(e,n,r){const s=`MicroCause.${e}`;let i,o,c;if(n instanceof globalThis.Error){i=`(${s}) ${n.name}`,o=n.message;const a=o.split(`
`).length;c=n.stack?`(${s}) ${n.stack.split(`
`).slice(0,a+3).join(`
`)}`:`${i}: ${o}`}else i=s,o=ae(n,0),c=`${i}: ${o}`;r.length>0&&(c+=`
    ${r.join(`
    `)}`),super(o),this._tag=e,this.traces=r,this[Uo]=iy,this.name=i,this.stack=c}pipe(){return y(this,arguments)}toString(){return this.stack}[A](){return this.stack}}class oy extends Iu{defect;constructor(e,n=[]){super("Die",e,n),this.defect=e}}const cy=(t,e=[])=>new oy(t,e);class ay extends Iu{constructor(e=[]){super("Interrupt","interrupted",e)}}const uy=(t=[])=>new ay(t),ly=t=>t._tag==="Interrupt",Bo=Symbol.for("effect/Micro/MicroFiber"),fy={_A:U,_E:U};class hy{context;interruptible;[Bo];_stack=[];_observers=[];_exit;_children;currentOpCount=0;constructor(e,n=!0){this.context=e,this.interruptible=n,this[Bo]=fy}getRef(e){return zf(this.context,e)}addObserver(e){return this._exit?(e(this._exit),ml):(this._observers.push(e),()=>{const n=this._observers.indexOf(e);n>=0&&this._observers.splice(n,1)})}_interrupted=!1;unsafeInterrupt(){this._exit||(this._interrupted=!0,this.interruptible&&this.evaluate(ji))}unsafePoll(){return this._exit}evaluate(e){if(this._exit)return;if(this._yielded!==void 0){const s=this._yielded;this._yielded=void 0,s()}const n=this.runLoop(e);if(n===Nn)return;const r=Vo.interruptChildren&&Vo.interruptChildren(this);if(r!==void 0)return this.evaluate(lr(r,()=>n));this._exit=n;for(let s=0;s<this._observers.length;s++)this._observers[s](n);this._observers.length=0}runLoop(e){let n=!1,r=e;this.currentOpCount=0;try{for(;;){if(this.currentOpCount++,!n&&this.getRef(Di).shouldYield(this)){n=!0;const s=r;r=lr(_y,()=>s)}if(r=r[$s](this),r===Nn){const s=this._yielded;return ar in s?(this._yielded=void 0,s):Nn}}}catch(s){return E(r,$s)?Rs(s):Rs(`MicroFiber.runLoop: Not a valid effect: ${String(r)}`)}}getCont(e){for(;;){const n=this._stack.pop();if(!n)return;const r=n[ur]&&n[ur](this);if(r)return{[e]:r};if(n[e])return n}}_yielded=void 0;yieldWith(e){return this._yielded=e,Nn}children(){return this._children??=new Set}}const Vo=M("effect/Micro/fiberMiddleware",()=>({interruptChildren:void 0})),Eu=Symbol.for("effect/Micro/identifier"),D=Symbol.for("effect/Micro/args"),$s=Symbol.for("effect/Micro/evaluate"),Re=Symbol.for("effect/Micro/successCont"),ce=Symbol.for("effect/Micro/failureCont"),ur=Symbol.for("effect/Micro/ensureCont"),Nn=Symbol.for("effect/Micro/Yield"),dy={_A:U,_E:U,_R:U},py={...N_,_op:"Micro",[sy]:dy,pipe(){return y(this,arguments)},[Symbol.iterator](){return new Zo(new ln(this))},toJSON(){return{_id:"Micro",op:this[Eu],...D in this?{args:this[D]}:void 0}},toString(){return V(this)},[A](){return V(this)}};function gy(t){return Rs("Micro.evaluate: Not implemented")}const Pr=t=>({...py,[Eu]:t.op,[$s]:t.eval??gy,[Re]:t.contA,[ce]:t.contE,[ur]:t.ensure}),Ai=t=>{const e=Pr(t);return function(){const n=Object.create(e);return n[D]=t.single===!1?arguments:arguments[0],n}},Ou=t=>{const e={...Pr(t),[ar]:ar,_tag:t.op,get[t.prop](){return this[D]},toJSON(){return{_id:"MicroExit",_tag:t.op,[t.prop]:this[D]}},[k](n){return Sy(n)&&n._tag===t.op&&v(this[D],n[D])},[w](){return N(this,O(x(t.op))(_(this[D])))}};return function(n){const r=Object.create(e);return r[D]=n,r[Re]=void 0,r[ce]=void 0,r[ur]=void 0,r}},Pi=Ou({op:"Success",prop:"value",eval(t){const e=t.getCont(Re);return e?e[Re](this[D],t):t.yieldWith(this)}}),$u=Ou({op:"Failure",prop:"cause",eval(t){let e=t.getCont(ce);for(;ly(this[D])&&e&&t.interruptible;)e=t.getCont(ce);return e?e[ce](this[D],t):t.yieldWith(this)}}),my=Ai({op:"Yield",eval(t){let e=!1;return t.getRef(Di).scheduleTask(()=>{e||t.evaluate(ky)},this[D]??0),t.yieldWith(()=>{e=!0})}}),_y=my(0),yy=Pi(void 0),xi=Ai({op:"WithMicroFiber",eval(t){return this[D](t)}}),lr=u(2,(t,e)=>{const n=Object.create(by);return n[D]=t,n[Re]=e,n}),by=Pr({op:"OnSuccess",eval(t){return t._stack.push(this),this[D]}}),Sy=t=>E(t,ar),Ru=Pi,Li=$u,ji=Li(uy()),Rs=t=>Li(cy(t)),ky=Ru(void 0),vy="setImmediate"in globalThis?globalThis.setImmediate:t=>setTimeout(t,0);class Mu{tasks=[];running=!1;scheduleTask(e,n){this.tasks.push(e),this.running||(this.running=!0,vy(this.afterScheduled))}afterScheduled=()=>{this.running=!1,this.runTasks()};runTasks(){const e=this.tasks;this.tasks=[];for(let n=0,r=e.length;n<r;n++)e[n]()}shouldYield(e){return e.currentOpCount>=e.getRef(Ey)}flush(){for(;this.tasks.length>0;)this.runTasks()}}const wy=u(2,(t,e)=>xi(n=>{const r=n.context;return n.context=e(r),Ry(t,()=>(n.context=r,yy))})),Iy=u(2,(t,e)=>wy(t,eh(e)));class Ey extends Tc()("effect/Micro/currentMaxOpsBeforeYield",{defaultValue:()=>2048}){}class Di extends Tc()("effect/Micro/currentScheduler",{defaultValue:()=>new Mu}){}const Oy=u(2,(t,e)=>{const n=Object.create($y);return n[D]=t,n[Re]=e.onSuccess,n[ce]=e.onFailure,n}),$y=Pr({op:"OnSuccessAndFailure",eval(t){return t._stack.push(this),this[D]}}),Ry=u(2,(t,e)=>Ty(n=>Oy(n(t),{onFailure:r=>lr(e(Li(r)),()=>$u(r)),onSuccess:r=>lr(e(Ru(r)),()=>Pi(r))}))),Tu=Ai({op:"SetInterruptible",ensure(t){if(t.interruptible=this[D],t._interrupted&&t.interruptible)return()=>ji}}),My=t=>xi(e=>e.interruptible?t:(e.interruptible=!0,e._stack.push(Tu(!1)),e._interrupted?ji:t)),Ty=t=>xi(e=>e.interruptible?(e.interruptible=!1,e._stack.push(Tu(!0)),t(My)):t(U)),Fy=(t,e)=>{const n=new hy(Di.context(new Mu));return n.evaluate(t),n};class Fu{buckets=[];scheduleTask(e,n){const r=this.buckets.length;let s,i=0;for(;i<r&&this.buckets[i][0]<=n;i++)s=this.buckets[i];s&&s[0]===n?s[1].push(e):i===r?this.buckets.push([n,[e]]):this.buckets.splice(i,0,[n,[e]])}}class Cy{maxNextTickBeforeTimer;running=!1;tasks=new Fu;constructor(e){this.maxNextTickBeforeTimer=e}starveInternal(e){const n=this.tasks.buckets;this.tasks.buckets=[];for(const[r,s]of n)for(let i=0;i<s.length;i++)s[i]();this.tasks.buckets.length===0?this.running=!1:this.starve(e)}starve(e=0){e>=this.maxNextTickBeforeTimer?setTimeout(()=>this.starveInternal(0),0):Promise.resolve(void 0).then(()=>this.starveInternal(e+1))}shouldYield(e){return e.currentOpCount>e.getFiberRef(za)?e.getFiberRef(Nr):!1}scheduleTask(e,n){this.tasks.scheduleTask(e,n),this.running||(this.running=!0,this.starve())}}const Cu=M(Symbol.for("effect/Scheduler/defaultScheduler"),()=>new Cy(2048));class Ny{tasks=new Fu;deferred=!1;scheduleTask(e,n){this.deferred?Cu.scheduleTask(e,n):this.tasks.scheduleTask(e,n)}shouldYield(e){return e.currentOpCount>e.getFiberRef(za)?e.getFiberRef(Nr):!1}flush(){for(;this.tasks.buckets.length>0;){const e=this.tasks.buckets;this.tasks.buckets=[];for(const[n,r]of e)for(let s=0;s<r.length;s++)r[s]()}this.deferred=!0}}const Nu=M(Symbol.for("effect/FiberRef/currentScheduler"),()=>lt(Cu)),Au=M(Symbol.for("effect/FiberRef/currentRequestMap"),()=>lt(new Map)),qi="InterruptSignal",Ui="Stateful",Bi="Resume",Vi="YieldNow",Qr=t=>({_tag:qi,cause:t}),Vn=t=>({_tag:Ui,onFiber:t}),ne=t=>({_tag:Bi,effect:t}),Ay=()=>({_tag:Vi}),Py="effect/FiberScope",fr=Symbol.for(Py);class xy{[fr]=fr;fiberId=be;roots=new Set;add(e,n){this.roots.add(n),n.addObserver(()=>{this.roots.delete(n)})}}class Ly{fiberId;parent;[fr]=fr;constructor(e,n){this.fiberId=e,this.parent=n}add(e,n){this.parent.tell(Vn(r=>{r.addChild(n),n.addObserver(()=>{r.removeChild(n)})}))}}const jy=t=>new Ly(t.id(),t),Ki=M(Symbol.for("effect/FiberScope/Global"),()=>new xy),Dy="effect/Fiber",qy=Symbol.for(Dy),Uy={_E:t=>t,_A:t=>t},By="effect/Fiber",Vy=Symbol.for(By),Pu=t=>Va(xa(t.await),t.inheritAll);({...pn});const jt="effect/FiberCurrent",Ky="effect/Logger",Jy=Symbol.for(Ky),Hy={_Message:t=>t,_Output:t=>t},Ji=t=>({[Jy]:Hy,log:t,pipe(){return y(this,arguments)}}),Gy=/^[^\s"=]*$/,Wy=(t,e)=>({annotations:n,cause:r,date:s,fiberId:i,logLevel:o,message:c,spans:a})=>{const l=m=>m.match(Gy)?m:t(m),d=(m,$)=>`${mu(m)}=${l($)}`,h=(m,$)=>" "+d(m,$);let p=d("timestamp",s.toISOString());p+=h("level",o.label),p+=h("fiber",ea(i));const g=gf(c);for(let m=0;m<g.length;m++)p+=h("message",ae(g[m],e));eg(r)||(p+=h("cause",bn(r,{renderErrorCause:!0})));for(const m of a)p+=" "+C_(s.getTime())(m);for(const[m,$]of n)p+=h(m,ae($,e));return p},Yy=t=>`"${t.replace(/\\([\s\S])|(")/g,"\\$1$2")}"`,zy=Ji(Wy(Yy)),Qy=typeof process=="object"&&process!==null&&typeof process.stdout=="object"&&process.stdout!==null;Qy&&process.stdout.isTTY;const xu="effect/MetricBoundaries",Ms=Symbol.for(xu);class Xy{values;[Ms]=Ms;constructor(e){this.values=e,this._hash=f(x(xu),O(fn(this.values)))}_hash;[w](){return this._hash}[k](e){return Zy(e)&&v(this.values,e.values)}pipe(){return y(this,arguments)}}const Zy=t=>E(t,Ms),tb=t=>{const e=f(t,Sc(et(Number.POSITIVE_INFINITY)),Af);return new Xy(e)},eb=t=>f(pf(t.count-1,e=>t.start*Math.pow(t.factor,e)),br,tb),nb="effect/MetricKeyType",Lu=Symbol.for(nb),ju="effect/MetricKeyType/Counter",Ts=Symbol.for(ju),rb="effect/MetricKeyType/Frequency",sb=Symbol.for(rb),ib="effect/MetricKeyType/Gauge",ob=Symbol.for(ib),Du="effect/MetricKeyType/Histogram",Fs=Symbol.for(Du),cb="effect/MetricKeyType/Summary",ab=Symbol.for(cb),qu={_In:t=>t,_Out:t=>t};class ub{incremental;bigint;[Lu]=qu;[Ts]=Ts;constructor(e,n){this.incremental=e,this.bigint=n,this._hash=x(ju)}_hash;[w](){return this._hash}[k](e){return Uu(e)}pipe(){return y(this,arguments)}}class lb{boundaries;[Lu]=qu;[Fs]=Fs;constructor(e){this.boundaries=e,this._hash=f(x(Du),O(_(this.boundaries)))}_hash;[w](){return this._hash}[k](e){return Bu(e)&&v(this.boundaries,e.boundaries)}pipe(){return y(this,arguments)}}const fb=t=>new ub(t?.incremental??!1,t?.bigint??!1),hb=t=>new lb(t),Uu=t=>E(t,Ts),db=t=>E(t,sb),pb=t=>E(t,ob),Bu=t=>E(t,Fs),gb=t=>E(t,ab),mb="effect/MetricKey",Vu=Symbol.for(mb),_b={_Type:t=>t},yb=zs(v);class Hi{name;keyType;description;tags;[Vu]=_b;constructor(e,n,r,s=[]){this.name=e,this.keyType=n,this.description=r,this.tags=s,this._hash=f(x(this.name+this.description),O(_(this.keyType)),O(fn(this.tags)))}_hash;[w](){return this._hash}[k](e){return bb(e)&&this.name===e.name&&v(this.keyType,e.keyType)&&v(this.description,e.description)&&yb(this.tags,e.tags)}pipe(){return y(this,arguments)}}const bb=t=>E(t,Vu),Sb=(t,e)=>new Hi(t,fb(e),Ws(e?.description)),kb=(t,e,n)=>new Hi(t,hb(e),Ws(n)),vb=u(2,(t,e)=>e.length===0?t:new Hi(t.name,t.keyType,t.description,jn(t.tags,e))),wb="effect/MetricState",vn=Symbol.for(wb),Ku="effect/MetricState/Counter",Cs=Symbol.for(Ku),Ju="effect/MetricState/Frequency",Ns=Symbol.for(Ju),Hu="effect/MetricState/Gauge",As=Symbol.for(Hu),Gu="effect/MetricState/Histogram",Ps=Symbol.for(Gu),Wu="effect/MetricState/Summary",xs=Symbol.for(Wu),wn={_A:t=>t};class Ib{count;[vn]=wn;[Cs]=Cs;constructor(e){this.count=e}[w](){return f(_(Ku),O(_(this.count)),N(this))}[k](e){return Pb(e)&&this.count===e.count}pipe(){return y(this,arguments)}}const Eb=zs(v);class Ob{occurrences;[vn]=wn;[Ns]=Ns;constructor(e){this.occurrences=e}_hash;[w](){return f(x(Ju),O(fn(B(this.occurrences.entries()))),N(this))}[k](e){return xb(e)&&Eb(B(this.occurrences.entries()),B(e.occurrences.entries()))}pipe(){return y(this,arguments)}}class $b{value;[vn]=wn;[As]=As;constructor(e){this.value=e}[w](){return f(_(Hu),O(_(this.value)),N(this))}[k](e){return Lb(e)&&this.value===e.value}pipe(){return y(this,arguments)}}class Rb{buckets;count;min;max;sum;[vn]=wn;[Ps]=Ps;constructor(e,n,r,s,i){this.buckets=e,this.count=n,this.min=r,this.max=s,this.sum=i}[w](){return f(_(Gu),O(_(this.buckets)),O(_(this.count)),O(_(this.min)),O(_(this.max)),O(_(this.sum)),N(this))}[k](e){return jb(e)&&v(this.buckets,e.buckets)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return y(this,arguments)}}class Mb{error;quantiles;count;min;max;sum;[vn]=wn;[xs]=xs;constructor(e,n,r,s,i,o){this.error=e,this.quantiles=n,this.count=r,this.min=s,this.max=i,this.sum=o}[w](){return f(_(Wu),O(_(this.error)),O(_(this.quantiles)),O(_(this.count)),O(_(this.min)),O(_(this.max)),O(_(this.sum)),N(this))}[k](e){return Db(e)&&this.error===e.error&&v(this.quantiles,e.quantiles)&&this.count===e.count&&this.min===e.min&&this.max===e.max&&this.sum===e.sum}pipe(){return y(this,arguments)}}const Tb=t=>new Ib(t),Fb=t=>new Ob(t),Cb=t=>new $b(t),Nb=t=>new Rb(t.buckets,t.count,t.min,t.max,t.sum),Ab=t=>new Mb(t.error,t.quantiles,t.count,t.min,t.max,t.sum),Pb=t=>E(t,Cs),xb=t=>E(t,Ns),Lb=t=>E(t,As),jb=t=>E(t,Ps),Db=t=>E(t,xs),qb="effect/MetricHook",Ub=Symbol.for(qb),Bb={_In:t=>t,_Out:t=>t},In=t=>({[Ub]:Bb,pipe(){return y(this,arguments)},...t}),Ko=BigInt(0),Vb=t=>{let e=t.keyType.bigint?Ko:0;const n=t.keyType.incremental?t.keyType.bigint?s=>s>=Ko:s=>s>=0:s=>!0,r=s=>{n(s)&&(e=e+s)};return In({get:()=>Tb(e),update:r,modify:r})},Kb=t=>{const e=new Map;for(const r of t.keyType.preregisteredWords)e.set(r,0);const n=r=>{const s=e.get(r)??0;e.set(r,s+1)};return In({get:()=>Fb(e),update:n,modify:n})},Jb=(t,e)=>{let n=e;return In({get:()=>Cb(n),update:r=>{n=r},modify:r=>{n=n+r}})},Hb=t=>{const e=t.keyType.boundaries.values,n=e.length,r=new Uint32Array(n+1),s=new Float64Array(n);let i=0,o=0,c=Number.MAX_VALUE,a=Number.MIN_VALUE;f(e,Qn(Ze),se((h,p)=>{s[p]=h}));const l=h=>{let p=0,g=n;for(;p!==g;){const m=Math.floor(p+(g-p)/2),$=s[m];h<=$?g=m:p=m,g===p+1&&(h<=s[p]?g=p:p=g)}r[p]=r[p]+1,i=i+1,o=o+h,h<c&&(c=h),h>a&&(a=h)},d=()=>{const h=Ys(n);let p=0;for(let g=0;g<n;g++){const m=s[g],$=r[g];p=p+$,h[g]=[m,p]}return h};return In({get:()=>Nb({buckets:d(),count:i,min:c,max:a,sum:o}),update:l,modify:l})},Gb=t=>{const{error:e,maxAge:n,maxSize:r,quantiles:s}=t.keyType,i=f(s,Qn(Ze)),o=Ys(r);let c=0,a=0,l=0,d=0,h=0;const p=m=>{const $=[];let F=0;for(;F!==r-1;){const K=o[F];if(K!=null){const[J,It]=K,nt=cs(m-J);$h(nt,jc)&&Oh(nt,n)&&$.push(It)}F=F+1}return Wb(e,i,Qn($,Ze))},g=(m,$)=>{if(r>0){c=c+1;const F=c%r;o[F]=[$,m]}d=a===0?m:Math.min(d,m),h=a===0?m:Math.max(h,m),a=a+1,l=l+m};return In({get:()=>Ab({error:e,quantiles:p(Date.now()),count:a,min:d,max:h,sum:l}),update:([m,$])=>g(m,$),modify:([m,$])=>g(m,$)})},Wb=(t,e,n)=>{const r=n.length;if(!tt(e))return he();const s=e[0],i=e.slice(1),o=Jo(t,r,S(),0,s,n),c=ft(o);return i.forEach(a=>{c.push(Jo(t,r,o.value,o.consumed,a,o.rest))}),se(c,a=>[a.quantile,a.value])},Jo=(t,e,n,r,s,i)=>{let o=t,c=e,a=n,l=r,d=s,h=i,p=t,g=e,m=n,$=r,F=s,K=i;for(;;){if(!tt(h))return{quantile:d,value:S(),consumed:l,rest:[]};if(d===1)return{quantile:d,value:R(wc(h)),consumed:l+h.length,rest:[]};const J=X(h),It=If(h,P=>P===J),nt=d*c,De=o/2*nt,Et=l+It[0].length,On=Math.abs(Et-nt);if(Et<nt-De){p=o,g=c,m=ze(h),$=Et,F=d,K=It[1],o=p,c=g,a=m,l=$,d=F,h=K;continue}if(Et>nt+De){const P=Q(a)?R(J):a;return{quantile:d,value:P,consumed:l,rest:h}}switch(a._tag){case"None":{p=o,g=c,m=ze(h),$=Et,F=d,K=It[1],o=p,c=g,a=m,l=$,d=F,h=K;continue}case"Some":{const P=Math.abs(nt-a.value);if(On<P){p=o,g=c,m=ze(h),$=Et,F=d,K=It[1],o=p,c=g,a=m,l=$,d=F,h=K;continue}return{quantile:d,value:R(a.value),consumed:l,rest:h}}}}throw new Error("BUG: MetricHook.resolveQuantiles - please report an issue at https://github.com/Effect-TS/effect/issues")},Yb="effect/MetricPair",zb=Symbol.for(Yb),Qb={_Type:t=>t},Xb=(t,e)=>({[zb]:Qb,metricKey:t,metricState:e,pipe(){return y(this,arguments)}}),Zb="effect/MetricRegistry",Ho=Symbol.for(Zb);class tS{[Ho]=Ho;map=dm();snapshot(){const e=[];for(const[n,r]of this.map)e.push(Xb(n,r.get()));return e}get(e){const n=f(this.map,qt(e),Dt);if(n==null){if(Uu(e.keyType))return this.getCounter(e);if(pb(e.keyType))return this.getGauge(e);if(db(e.keyType))return this.getFrequency(e);if(Bu(e.keyType))return this.getHistogram(e);if(gb(e.keyType))return this.getSummary(e);throw new Error("BUG: MetricRegistry.get - unknown MetricKeyType - please report an issue at https://github.com/Effect-TS/effect/issues")}else return n}getCounter(e){let n=f(this.map,qt(e),Dt);if(n==null){const r=Vb(e);f(this.map,Ke(e))||f(this.map,Je(e,r)),n=r}return n}getFrequency(e){let n=f(this.map,qt(e),Dt);if(n==null){const r=Kb(e);f(this.map,Ke(e))||f(this.map,Je(e,r)),n=r}return n}getGauge(e){let n=f(this.map,qt(e),Dt);if(n==null){const r=Jb(e,e.keyType.bigint?BigInt(0):0);f(this.map,Ke(e))||f(this.map,Je(e,r)),n=r}return n}getHistogram(e){let n=f(this.map,qt(e),Dt);if(n==null){const r=Hb(e);f(this.map,Ke(e))||f(this.map,Je(e,r)),n=r}return n}getSummary(e){let n=f(this.map,qt(e),Dt);if(n==null){const r=Gb(e);f(this.map,Ke(e))||f(this.map,Je(e,r)),n=r}return n}}const eS=()=>new tS,nS="effect/Metric",rS=Symbol.for(nS),sS={_Type:t=>t,_In:t=>t,_Out:t=>t},Go=M(Symbol.for("effect/Metric/globalMetricRegistry"),()=>eS()),Yu=function(t,e,n,r){const s=Object.assign(i=>qa(i,o=>aS(s,o)),{[rS]:sS,keyType:t,unsafeUpdate:e,unsafeValue:n,unsafeModify:r,register(){return this.unsafeValue([]),this},pipe(){return y(this,arguments)}});return s},xr=(t,e)=>zu(Sb(t,e)),zu=t=>{let e;const n=new WeakMap,r=s=>{if(s.length===0)return e!==void 0||(e=Go.get(t)),e;let i=n.get(s);return i!==void 0||(i=Go.get(vb(t,s)),n.set(s,i)),i};return Yu(t.keyType,(s,i)=>r(i).update(s),s=>r(s).get(),(s,i)=>r(i).modify(s))},iS=(t,e,n)=>zu(kb(t,e,n)),oS=u(3,(t,e,n)=>cS(t,[q_(e,n)])),cS=u(2,(t,e)=>Yu(t.keyType,(n,r)=>t.unsafeUpdate(n,jn(e,r)),n=>t.unsafeValue(jn(e,n)),(n,r)=>t.unsafeModify(n,jn(e,r)))),aS=u(2,(t,e)=>Oi(vs,n=>b(()=>t.unsafeUpdate(e,n))));({...Hs});const uS=u(2,(t,e)=>Oi(Au,n=>b(()=>{if(n.has(t)){const r=n.get(t);r.state.completed||(r.state.completed=!0,ru(r.result,e))}}))),lS="effect/Supervisor",Lr=Symbol.for(lS),Gi={_T:t=>t};class jr{underlying;value0;[Lr]=Gi;constructor(e,n){this.underlying=e,this.value0=n}get value(){return this.value0}onStart(e,n,r,s){this.underlying.onStart(e,n,r,s)}onEnd(e,n){this.underlying.onEnd(e,n)}onEffect(e,n){this.underlying.onEffect(e,n)}onSuspend(e){this.underlying.onSuspend(e)}onResume(e){this.underlying.onResume(e)}map(e){return new jr(this,f(this.value,ct(e)))}zip(e){return new Dr(this,e)}}class Dr{left;right;_tag="Zip";[Lr]=Gi;constructor(e,n){this.left=e,this.right=n}get value(){return Ba(this.left.value,this.right.value)}onStart(e,n,r,s){this.left.onStart(e,n,r,s),this.right.onStart(e,n,r,s)}onEnd(e,n){this.left.onEnd(e,n),this.right.onEnd(e,n)}onEffect(e,n){this.left.onEffect(e,n),this.right.onEffect(e,n)}onSuspend(e){this.left.onSuspend(e),this.right.onSuspend(e)}onResume(e){this.left.onResume(e),this.right.onResume(e)}map(e){return new jr(this,f(this.value,ct(e)))}zip(e){return new Dr(this,e)}}const Qu=t=>E(t,Lr)&&Xo(t,"Zip");class fS{effect;[Lr]=Gi;constructor(e){this.effect=e}get value(){return this.effect}onStart(e,n,r,s){}onEnd(e,n){}onEffect(e,n){}onSuspend(e){}onResume(e){}map(e){return new jr(this,f(this.value,ct(e)))}zip(e){return new Dr(this,e)}onRun(e,n){return e()}}const hS=t=>new fS(t),qr=M("effect/Supervisor/none",()=>hS(vt)),dS=Fe,Xu="Empty",Zu="AddSupervisor",tl="RemoveSupervisor",el="AndThen",Xe={_tag:Xu},Kn=(t,e)=>({_tag:el,first:t,second:e}),pS=(t,e)=>gS(e,et(t)),gS=(t,e)=>{let n=t,r=e;for(;ge(r);){const s=me(r);switch(s._tag){case Xu:{r=Ut(r);break}case Zu:{n=n.zip(s.supervisor),r=Ut(r);break}case tl:{n=Ls(n,s.supervisor),r=Ut(r);break}case el:{r=pt(s.first)(pt(s.second)(Ut(r)));break}}}return n},Ls=(t,e)=>v(t,e)?qr:Qu(t)?Ls(t.left,e).zip(Ls(t.right,e)):t,hr=t=>v(t,qr)?zt():Qu(t)?f(hr(t.left),nn(hr(t.right))):ui(t),mS=(t,e)=>{if(v(t,e))return Xe;const n=hr(t),r=hr(e),s=f(r,co(n),tr(Xe,(o,c)=>Kn(o,{_tag:Zu,supervisor:c}))),i=f(n,co(r),tr(Xe,(o,c)=>Kn(o,{_tag:tl,supervisor:c})));return Kn(s,i)},_S=dS({empty:Xe,patch:pS,combine:Kn,diff:mS}),yS=xr("effect_fiber_started",{incremental:!0}),Wo=xr("effect_fiber_active"),bS=xr("effect_fiber_successes",{incremental:!0}),SS=xr("effect_fiber_failures",{incremental:!0}),kS=oS(iS("effect_fiber_lifetimes",eb({start:.5,factor:2,count:35})),"time_unit","milliseconds"),He="Continue",vS="Done",Yo="Yield",wS={_E:t=>t,_A:t=>t},An=t=>{throw new Error(`BUG: FiberRuntime - ${ae(t)} - please report an issue at https://github.com/Effect-TS/effect/issues`)},$t=Symbol.for("effect/internal/fiberRuntime/YieldedOp"),Rt=M("effect/internal/fiberRuntime/yieldedOpChannel",()=>({currentOp:null})),Ge={[Gn]:(t,e,n)=>G(()=>e.effect_instruction_i1(n)),OnStep:(t,e,n)=>j(j(n)),[Wn]:(t,e,n)=>G(()=>e.effect_instruction_i2(n)),[Ks]:(t,e,n)=>(t.patchRuntimeFlags(t.currentRuntimeFlags,e.patch),Nt(t.currentRuntimeFlags)&&t.isInterrupted()?T(t.getInterruptedCause()):j(n)),[Yn]:(t,e,n)=>(G(()=>e.effect_instruction_i2(n)),G(()=>e.effect_instruction_i0())?(t.pushStack(e),G(()=>e.effect_instruction_i1())):vt),[xn]:(t,e,n)=>{const r=G(()=>e.effect_instruction_i0.next(n));return r.done?j(r.value):(t.pushStack(e),Fl(r.value))}},IS={[qi]:(t,e,n,r)=>(t.processNewInterruptSignal(r.cause),Nt(e)?T(r.cause):n),[Bi]:(t,e,n,r)=>{throw new Error("It is illegal to have multiple concurrent run loops in a single fiber")},[Ui]:(t,e,n,r)=>(r.onFiber(t,wu(e)),n),[Vi]:(t,e,n,r)=>I(Ii(),()=>n)},ES=t=>Si(jp(t),e=>rl(Xp(e),([n,r])=>{const s=new Map,i=[];for(const c of r){i.push(Ht(c));for(const a of c)s.set(a.request,a)}const o=i.flat();return $i(LS(n.runAll(i),o,()=>o.forEach(c=>{c.listeners.interrupted=!0})),Au,s)},!1,!1)),OS=Js();class nl extends P_{[qy]=Uy;[Vy]=wS;_fiberRefs;_fiberId;_queue=new Array;_children=null;_observers=new Array;_running=!1;_stack=[];_asyncInterruptor=null;_asyncBlockingOn=null;_exitValue=null;_steps=[];_isYielding=!1;currentRuntimeFlags;currentOpCount=0;currentSupervisor;currentScheduler;currentTracer;currentSpan;currentContext;currentDefaultServices;constructor(e,n,r){if(super(),this.currentRuntimeFlags=r,this._fiberId=e,this._fiberRefs=n,ho(r)){const s=this.getFiberRef(vs);yS.unsafeUpdate(1,s),Wo.unsafeUpdate(1,s)}this.refreshRefCache()}commit(){return Pu(this)}id(){return this._fiberId}resume(e){this.tell(ne(e))}get status(){return this.ask((e,n)=>n)}get runtimeFlags(){return this.ask((e,n)=>ry(n)?e.currentRuntimeFlags:n.runtimeFlags)}scope(){return jy(this)}get children(){return this.ask(e=>Array.from(e.getChildren()))}getChildren(){return this._children===null&&(this._children=new Set),this._children}getInterruptedCause(){return this.getFiberRef(Cn)}fiberRefs(){return this.ask(e=>e.getFiberRefs())}ask(e){return H(()=>{const n=um(this._fiberId);return this.tell(Vn((r,s)=>{ru(n,b(()=>e(r,s)))})),nu(n)})}tell(e){this._queue.push(e),this._running||(this._running=!0,this.drainQueueLaterOnExecutor())}get await(){return cn(e=>{const n=r=>e(C(r));return this.tell(Vn((r,s)=>{r._exitValue!==null?n(this._exitValue):r.addObserver(n)})),b(()=>this.tell(Vn((r,s)=>{r.removeObserver(n)})))},this.id())}get inheritAll(){return gt((e,n)=>{const r=e.id(),s=e.getFiberRefs(),i=n.runtimeFlags,o=this.getFiberRefs(),c=p_(s,r,o);e.setFiberRefs(c);const a=e.getFiberRef(zo),l=f(Un(i,a),go(Ce),go(ys));return Ng(l)})}get poll(){return b(()=>Ws(this._exitValue))}unsafePoll(){return this._exitValue}interruptAsFork(e){return b(()=>this.tell(Qr(At(e))))}unsafeInterruptAsFork(e){this.tell(Qr(At(e)))}addObserver(e){this._exitValue!==null?e(this._exitValue):this._observers.push(e)}removeObserver(e){this._observers=this._observers.filter(n=>n!==e)}getFiberRefs(){return this.setFiberRef(zo,this.currentRuntimeFlags),this._fiberRefs}unsafeDeleteFiberRef(e){this._fiberRefs=gu(this._fiberRefs,e)}getFiberRef(e){return this._fiberRefs.locals.has(e)?this._fiberRefs.locals.get(e)[0][1]:e.initial}setFiberRef(e,n){this._fiberRefs=Is(this._fiberRefs,{fiberId:this._fiberId,fiberRef:e,value:n}),this.refreshRefCache()}refreshRefCache(){this.currentDefaultServices=this.getFiberRef(an),this.currentTracer=this.currentDefaultServices.unsafeMap.get(hu.key),this.currentSupervisor=this.getFiberRef(xS),this.currentScheduler=this.getFiberRef(Nu),this.currentContext=this.getFiberRef(Cr),this.currentSpan=this.currentContext.unsafeMap.get(du.key)}setFiberRefs(e){this._fiberRefs=e,this.refreshRefCache()}addChild(e){this.getChildren().add(e)}removeChild(e){this.getChildren().delete(e)}transferChildren(e){const n=this._children;if(this._children=null,n!==null&&n.size>0)for(const r of n)r._exitValue===null&&e.add(this.currentRuntimeFlags,r)}drainQueueOnCurrentThread(){let e=!0;for(;e;){let n=He;const r=globalThis[jt];globalThis[jt]=this;try{for(;n===He;)n=this._queue.length===0?vS:this.evaluateMessageWhileSuspended(this._queue.splice(0,1)[0])}finally{this._running=!1,globalThis[jt]=r}this._queue.length>0&&!this._running?(this._running=!0,n===Yo?(this.drainQueueLaterOnExecutor(),e=!1):e=!0):e=!1}}drainQueueLaterOnExecutor(){this.currentScheduler.scheduleTask(this.run,this.getFiberRef(Nr))}drainQueueWhileRunning(e,n){let r=n;for(;this._queue.length>0;){const s=this._queue.splice(0,1)[0];r=IS[s._tag](this,e,r,s)}return r}isInterrupted(){return!ng(this.getFiberRef(Cn))}addInterruptedCause(e){const n=this.getFiberRef(Cn);this.setFiberRef(Cn,ot(n,e))}processNewInterruptSignal(e){this.addInterruptedCause(e),this.sendInterruptSignalToAllChildren()}sendInterruptSignalToAllChildren(){if(this._children===null||this._children.size===0)return!1;let e=!1;for(const n of this._children)n.tell(Qr(At(this.id()))),e=!0;return e}interruptAllChildren(){if(this.sendInterruptSignalToAllChildren()){const e=this._children.values();this._children=null;let n=!1;return wi({while:()=>!n,body:()=>{const s=e.next();return s.done?b(()=>{n=!0}):kn(s.value.await)},step:()=>{}})}return null}reportExitValue(e){if(ho(this.currentRuntimeFlags)){const n=this.getFiberRef(vs),r=this.id().startTimeMillis,s=Date.now();switch(kS.unsafeUpdate(s-r,n),Wo.unsafeUpdate(-1,n),e._tag){case ut:{bS.unsafeUpdate(1,n);break}case at:{SS.unsafeUpdate(1,n);break}}}if(e._tag==="Failure"){const n=this.getFiberRef(Qg);!gi(e.cause)&&n._tag==="Some"&&this.log("Fiber terminated with an unhandled error",e.cause,n)}}setExitValue(e){this._exitValue=e,this.reportExitValue(e);for(let n=this._observers.length-1;n>=0;n--)this._observers[n](e);this._observers=[]}getLoggers(){return this.getFiberRef(FS)}log(e,n,r){const s=kt(r)?r.value:this.getFiberRef(Wg),i=this.getFiberRef($S);if(T_(i,s))return;const o=this.getFiberRef(Yg),c=this.getFiberRef(Gg),a=this.getLoggers(),l=this.getFiberRefs();if(zc(a)>0){const d=Zs(this.getFiberRef(an),Fi),h=new Date(d.unsafeCurrentTimeMillis());xl(l,()=>{for(const p of a)p.log({fiberId:this.id(),logLevel:s,message:e,cause:n,context:l,spans:o,annotations:c,date:h})})}}evaluateMessageWhileSuspended(e){switch(e._tag){case Vi:return Yo;case qi:return this.processNewInterruptSignal(e.cause),this._asyncInterruptor!==null&&(this._asyncInterruptor(T(e.cause)),this._asyncInterruptor=null),He;case Bi:return this._asyncInterruptor=null,this._asyncBlockingOn=null,this.evaluateEffect(e.effect),He;case Ui:return e.onFiber(this,this._exitValue!==null?ey:ny(this.currentRuntimeFlags,this._asyncBlockingOn)),He;default:return An(e)}}evaluateEffect(e){this.currentSupervisor.onResume(this);try{let n=Nt(this.currentRuntimeFlags)&&this.isInterrupted()?T(this.getInterruptedCause()):e;for(;n!==null;){const r=n,s=this.runLoop(r);if(s===$t){const i=Rt.currentOp;Rt.currentOp=null,i._op===Ln?Np(this.currentRuntimeFlags)?(this.tell(Ay()),this.tell(ne(Vt)),n=null):n=Vt:i._op===Ye&&(n=null)}else{this.currentRuntimeFlags=f(this.currentRuntimeFlags,Ap(ys));const i=this.interruptAllChildren();i!==null?n=I(i,()=>s):(this._queue.length===0?this.setExitValue(s):this.tell(ne(s)),n=null)}}}finally{this.currentSupervisor.onSuspend(this)}}start(e){if(this._running)this.tell(ne(e));else{this._running=!0;const n=globalThis[jt];globalThis[jt]=this;try{this.evaluateEffect(e)}finally{this._running=!1,globalThis[jt]=n,this._queue.length>0&&this.drainQueueLaterOnExecutor()}}}startFork(e){this.tell(ne(e))}patchRuntimeFlags(e,n){const r=Bn(e,n);return globalThis[jt]=this,this.currentRuntimeFlags=r,r}initiateAsync(e,n){let r=!1;const s=i=>{r||(r=!0,this.tell(ne(i)))};Nt(e)&&(this._asyncInterruptor=s);try{n(s)}catch(i){s(mt(St(i)))}}pushStack(e){this._stack.push(e),e._op==="OnStep"&&this._steps.push({refs:this.getFiberRefs(),flags:this.currentRuntimeFlags})}popStack(){const e=this._stack.pop();if(e)return e._op==="OnStep"&&this._steps.pop(),e}getNextSuccessCont(){let e=this.popStack();for(;e;){if(e._op!==Br)return e;e=this.popStack()}}getNextFailCont(){let e=this.popStack();for(;e;){if(e._op!==Gn&&e._op!==Yn&&e._op!==xn)return e;e=this.popStack()}}[jl](e){return b(()=>Mc(this.currentContext,e))}Left(e){return z(e.left)}None(e){return z(new Za)}Right(e){return j(e.right)}Some(e){return j(e.value)}Micro(e){return ir(n=>{let r=n;const s=Fy(Iy(e,this.currentContext));return s.addObserver(i=>{if(i._tag==="Success")return r(j(i.value));switch(i.cause._tag){case"Interrupt":return r(T(At(be)));case"Fail":return r(z(i.cause.error));case"Die":return r(So(i.cause.defect))}}),ir(i=>{r=o=>{i(vt)},s.unsafeInterrupt()})})}[ic](e){const n=G(()=>e.effect_instruction_i0()),r=this.getNextSuccessCont();return r!==void 0?(r._op in Ge||An(r),Ge[r._op](this,r,n)):(Rt.currentOp=j(n),$t)}[ut](e){const n=e,r=this.getNextSuccessCont();return r!==void 0?(r._op in Ge||An(r),Ge[r._op](this,r,n.effect_instruction_i0)):(Rt.currentOp=n,$t)}[at](e){const n=e.effect_instruction_i0,r=this.getNextFailCont();if(r!==void 0)switch(r._op){case Br:case Wn:return Nt(this.currentRuntimeFlags)&&this.isInterrupted()?T(mo(n)):G(()=>r.effect_instruction_i1(n));case"OnStep":return Nt(this.currentRuntimeFlags)&&this.isInterrupted()?T(mo(n)):j(T(n));case Ks:return this.patchRuntimeFlags(this.currentRuntimeFlags,r.patch),Nt(this.currentRuntimeFlags)&&this.isInterrupted()?T(ot(n,this.getInterruptedCause())):T(n);default:An(r)}else return Rt.currentOp=T(n),$t}[oc](e){return G(()=>e.effect_instruction_i0(this,wu(this.currentRuntimeFlags)))}Blocked(e){const n=this.getFiberRefs(),r=this.currentRuntimeFlags;if(this._steps.length>0){const s=[],i=this._steps[this._steps.length-1];let o=this.popStack();for(;o&&o._op!=="OnStep";)s.push(o),o=this.popStack();this.setFiberRefs(i.refs),this.currentRuntimeFlags=i.flags;const c=J_(i.refs,n),a=Un(i.flags,r);return j(Ma(e.effect_instruction_i0,gt(l=>{for(;s.length>0;)l.pushStack(s.pop());return l.setFiberRefs(H_(l.id(),l.getFiberRefs())(c)),l.currentRuntimeFlags=Bn(a)(l.currentRuntimeFlags),e.effect_instruction_i1})))}return Fr(s=>I(sl(Ig(e.effect_instruction_i0)),()=>s(e.effect_instruction_i1)))}RunBlocked(e){return ES(e.effect_instruction_i0)}[hn](e){const n=e.effect_instruction_i0,r=this.currentRuntimeFlags,s=Bn(r,n);if(Nt(s)&&this.isInterrupted())return T(this.getInterruptedCause());if(this.patchRuntimeFlags(this.currentRuntimeFlags,n),e.effect_instruction_i1){const i=Un(s,r);return this.pushStack(new Eg(i,e)),G(()=>e.effect_instruction_i1(r))}else return Vt}[Gn](e){return this.pushStack(e),e.effect_instruction_i0}OnStep(e){return this.pushStack(e),e.effect_instruction_i0}[Br](e){return this.pushStack(e),e.effect_instruction_i0}[Wn](e){return this.pushStack(e),e.effect_instruction_i0}[Ye](e){return this._asyncBlockingOn=e.effect_instruction_i1,this.initiateAsync(this.currentRuntimeFlags,e.effect_instruction_i0),Rt.currentOp=e,$t}[Ln](e){return this._isYielding=!1,Rt.currentOp=e,$t}[Yn](e){const n=e.effect_instruction_i0,r=e.effect_instruction_i1;return n()?(this.pushStack(e),r()):Vt}[xn](e){return Ge[xn](this,e,void 0)}[yr](e){return G(()=>e.commit())}runLoop(e){let n=e;for(this.currentOpCount=0;;){if((this.currentRuntimeFlags&Cp)!==0&&this.currentSupervisor.onEffect(this,n),this._queue.length>0&&(n=this.drainQueueWhileRunning(this.currentRuntimeFlags,n)),!this._isYielding){this.currentOpCount+=1;const r=this.currentScheduler.shouldYield(this);if(r!==!1){this._isYielding=!0,this.currentOpCount=0;const s=n;n=I(Ii({priority:r}),()=>s)}}try{if(n=this.currentTracer.context(()=>{if(OS!==n[Oe]._V){const r=this.getFiberRef(Xg);if(r._tag==="Some"){const s=n[Oe]._V;this.log(`Executing an Effect versioned ${s} with a Runtime of version ${Js()}, you may want to dedupe the effect dependencies, you can use the language service plugin to detect this at compile time: https://github.com/Effect-TS/language-service`,we,r)}}return this[n._op](n)},this),n===$t){const r=Rt.currentOp;return r._op===Ln||r._op===Ye?$t:(Rt.currentOp=null,r._op===ut||r._op===at?r:T(St(r)))}}catch(r){n!==$t&&!E(n,"_op")||!(n._op in this)?n=Rg(`Not a valid effect: ${ae(n)}`):sm(r)?n=T(ot(St(r),At(be))):n=So(r)}}}run=()=>{this.drainQueueOnCurrentThread()}}const $S=M("effect/FiberRef/currentMinimumLogLevel",()=>lt(F_("Info"))),RS=t=>Ji(e=>{const n=y_(e.context,an);Zs(n,Ci).unsafe.log(t.log(e))}),MS=M(Symbol.for("effect/Logger/defaultLogger"),()=>RS(zy)),TS=M(Symbol.for("effect/Logger/tracerLogger"),()=>Ji(({annotations:t,cause:e,context:n,fiberId:r,logLevel:s,message:i})=>{const o=th(un(n,Cr),du);if(o._tag==="None"||o.value._tag==="ExternalSpan")return;const c=Mc(un(n,an),Fi),a={};for(const[l,d]of t)a[l]=d;a["effect.fiberId"]=bd(r),a["effect.logLevel"]=s.label,e!==null&&e._tag!=="Empty"&&(a["effect.cause"]=bn(e,{renderErrorCause:!0})),o.value.event(ae(Array.isArray(i)&&i.length===1?i[0]:i),c.unsafeCurrentTimeNanos(),a)})),FS=M(Symbol.for("effect/FiberRef/currentLoggers"),()=>Kg(ui(MS,TS))),rl=(t,e,n,r,s)=>Fr(i=>Cg(o=>gt(c=>{let a=Array.from(t).reverse(),l=a.length;if(l===0)return vt;let d=0,h=!1;const p=a.length,g=new Set,m=new Array,$=()=>g.forEach(P=>{P.currentScheduler.scheduleTask(()=>{P.unsafeInterruptAsFork(c.id())},0)}),F=new Array,K=new Array,J=new Array,It=()=>{const P=m.filter(({exit:Z})=>Z._tag==="Failure").sort((Z,_t)=>Z.index<_t.index?-1:Z.index===_t.index?0:1).map(({exit:Z})=>Z);return P.length===0&&P.push(Vt),P},nt=(P,Z=!1)=>{const _t=Ua(o(P)),W=NS(_t,c,c.currentRuntimeFlags,Ki);return c.currentScheduler.scheduleTask(()=>{Z&&W.unsafeInterruptAsFork(c.id()),W.resume(_t)},0),W},De=()=>{r||(l-=a.length,a=[]),h=!0,$()},Et=Na,On=nt(cn(P=>{const Z=(W,Ot)=>{W._op==="Blocked"?J.push(W):(m.push({index:Ot,exit:W}),W._op==="Failure"&&!h&&De())},_t=()=>{if(a.length>0){const W=a.pop();let Ot=d++;const $n=()=>{const rt=a.pop();return Ot=d++,I(Ii(),()=>I(Et(i(e(rt,Ot))),Lt))},Lt=rt=>a.length>0&&(Z(rt,Ot),a.length>0)?$n():C(rt),Rn=I(Et(i(e(W,Ot))),Lt),yt=nt(Rn);F.push(yt),g.add(yt),h&&yt.currentScheduler.scheduleTask(()=>{yt.unsafeInterruptAsFork(c.id())},0),yt.addObserver(rt=>{let qe;if(rt._op==="Failure"?qe=rt:qe=rt.effect_instruction_i0,K.push(yt),g.delete(yt),Z(qe,Ot),m.length===l)P(C(Wt(Eo(It(),{parallel:!0}),()=>Vt)));else if(J.length+m.length===l){const Yi=It(),dl=J.map(Ue=>Ue.effect_instruction_i0).reduce(ba);P(C(Ma(dl,rl([Wt(Eo(Yi,{parallel:!0}),()=>Vt),...J.map(Ue=>Ue.effect_instruction_i1)],Ue=>Ue,n,!0))))}else _t()})}};for(let W=0;W<p;W++)_t()}));return kn(vi(xa(i(Pu(On))),eu({onFailure:P=>{De();const Z=J.length+1,_t=Math.min(J.length,J.length),W=Array.from(J);return cn(Ot=>{let $n=0,Lt=0;const Rn=(rt,qe)=>Yi=>{$n++,$n===Z&&Ot(j(T(P))),W.length>0&&qe&&yt()},yt=()=>{nt(W.pop(),!0).addObserver(Rn(Lt,!0)),Lt++};On.addObserver(Rn(Lt,!1)),Lt++;for(let rt=0;rt<_t;rt++)yt()})},onSuccess:()=>Bt(K,P=>P.inheritAll)})))}))),sl=t=>AS(t,Ki),CS=(t,e,n,r=null)=>{const s=il(t,e,n,r);return s.resume(t),s},NS=(t,e,n,r=null)=>il(t,e,n,r),il=(t,e,n,r=null)=>{const s=na(),i=e.getFiberRefs(),o=g_(i,s),c=new nl(s,o,n),a=un(o,Cr),l=c.currentSupervisor;return l.onStart(a,t,R(e),c),c.addObserver(h=>l.onEnd(h,c)),(r!==null?r:f(e.getFiberRef(ws),Wt(()=>e.scope()))).add(n,c),c},AS=(t,e)=>gt((n,r)=>C(CS(t,n,r.runtimeFlags,e))),PS=t=>Le(t,{differ:_S,fork:Xe}),zo=Hg(Pp),xS=PS(qr),LS=(t,e,n)=>Pa(r=>I(I(sl(La(t)),s=>cn(i=>{const o=e.map(l=>l.listeners.count),c=()=>{o.every(l=>l===0)&&e.every(l=>l.result.state.current._tag==="Pending"?!0:!!(l.result.state.current._tag==="Done"&&Ri(l.result.state.current.effect)&&l.result.state.current.effect._tag==="Failure"&&rg(l.result.state.current.effect.cause)))&&(a.forEach(l=>l()),n?.(),i(Ag(s)))};s.addObserver(l=>{a.forEach(d=>d()),i(l)});const a=e.map((l,d)=>{const h=p=>{o[d]=p,c()};return l.listeners.addObserver(h),()=>l.listeners.removeObserver(h)});return c(),b(()=>{a.forEach(l=>l())})})),()=>H(()=>{const s=e.flatMap(i=>i.state.completed?[]:[i]);return Si(s,i=>uS(i.request,om(r)))}))),jS=tm,DS=em,En=t=>function(){if(arguments.length===1){const e=arguments[0];return(n,...r)=>t(e,n,...r)}return t.apply(this,arguments)},ol=En((t,e,n)=>{const r=na(),s=[[Cr,[[r,t.context]]]];n?.scheduler&&s.push([Nu,[[r,n.scheduler]]]);let i=b_(t.fiberRefs,{entries:s,forkAs:r});n?.updateRefs&&(i=n.updateRefs(i,r));const o=new nl(r,i,t.runtimeFlags);let c=e;n?.scope&&(c=I(DS(n.scope,K_),l=>Ka(Zg(l,Pa(d=>v(d,o.id())?vt:Ja(o,d))),vi(e,d=>jS(l,d)))));const a=o.currentSupervisor;return a!==qr&&(a.onStart(t.context,c,S(),o),o.addObserver(l=>a.onEnd(l,o))),Ki.add(t.runtimeFlags,o),n?.immediate===!1?o.resume(c):o.start(c),o}),qS=En((t,e)=>{const n=KS(t)(e);if(n._tag==="Failure")throw cl(n.effect_instruction_i0);return n.effect_instruction_i0});class US extends Error{fiber;_tag="AsyncFiberException";constructor(e){super(`Fiber #${e.id().id} cannot be resolved synchronously. This is caused by using runSync on an effect that performs async work`),this.fiber=e,this.name=this._tag,this.stack=this.message}}const BS=t=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new US(t);return Error.stackTraceLimit=e,n},Xr=Symbol.for("effect/Runtime/FiberFailure"),Pn=Symbol.for("effect/Runtime/FiberFailure/Cause");class VS extends Error{[Xr];[Pn];constructor(e){const n=$a(e)[0];super(n?.message||"An error has occurred"),this[Xr]=Xr,this[Pn]=e,this.name=n?`(FiberFailure) ${n.name}`:"FiberFailure",n?.stack&&(this.stack=n.stack)}toJSON(){return{_id:"FiberFailure",cause:this[Pn].toJSON()}}toString(){return"(FiberFailure) "+bn(this[Pn],{renderErrorCause:!0})}[A](){return this.toString()}}const cl=t=>{const e=Error.stackTraceLimit;Error.stackTraceLimit=0;const n=new VS(t);return Error.stackTraceLimit=e,n},al=t=>{const e=t;switch(e._op){case"Failure":case"Success":return e;case"Left":return Oo(e.left);case"Right":return j(e.right);case"Some":return j(e.value);case"None":return Oo(Za())}},KS=En((t,e)=>{const n=al(e);if(n)return n;const r=new Ny,s=ol(t)(e,{scheduler:r});r.flush();const i=s.unsafePoll();return i||im(yi(BS(s),Mi(s)))}),JS=En((t,e,n)=>HS(t,e,n).then(r=>{switch(r._tag){case ut:return r.effect_instruction_i0;case at:throw cl(r.effect_instruction_i0)}})),HS=En((t,e,n)=>new Promise(r=>{const s=al(e);s&&r(s);const i=ol(t)(e);i.addObserver(o=>{r(o)}),n?.signal!==void 0&&(n.signal.aborted?i.unsafeInterruptAsFork(i.id()):n.signal.addEventListener("abort",()=>{i.unsafeInterruptAsFork(i.id())},{once:!0}))}));class GS{context;runtimeFlags;fiberRefs;constructor(e,n,r){this.context=e,this.runtimeFlags=n,this.fiberRefs=r}pipe(){return y(this,arguments)}}const WS=t=>new GS(t.context,t.runtimeFlags,t.fiberRefs),YS=_a(Ce,ga,pa),ul=WS({context:Xs(),runtimeFlags:YS,fiberRefs:S_()}),zS=JS(ul),QS=qS(ul),XS=t=>Oi(an,e=>t(Zs(e,Ci))),ZS=(...t)=>XS(e=>e.log(...t)),t0=C,e0=Ss,n0=B_,r0=xe,ll=qa,s0=zS,i0=QS,Wi=ZS,fl=t=>f(t0(`Hello from Lens Studio, ${t}!`),ll(e=>Wi(e))),hl=(t,e)=>f(n0({try:()=>{if(e===0)throw new Error("Division by zero");return t/e},catch:n=>new Error(String(n))}),ll(n=>Wi(`Result: ${n}`))),js=t=>i0(t),o0=t=>s0(t),c0=()=>{const t=js(fl("Developer")),e=js(e0(hl(10,2),n=>Wi(`Error: ${n.message}`).pipe(r0(0))));return{greeting:t,computation:e}};exports.computeEffect=hl;exports.exampleUsage=c0;exports.greetEffect=fl;exports.runEffectPromise=o0;exports.runEffectSync=js;exports.specsCore=pl;
